/* Copyright (C) 2023 by WorkerBot.AI */
!function(t){function e(e){var n=t(e).data("datagrid");return n.filterSource?n.filterSource.rows:n.data.rows}function n(e){return t(e).data("datagrid").data.footer||[]}function o(o,a,r,l,i){a=(a=a||e(o)).concat(r||n(o));var s=t(o),c=['<table border="1" rull="all" style="border-collapse:collapse">'],d=(i=i||s.datagrid("getColumnFields",!0).concat(s.datagrid("getColumnFields",!1)),"height:32px"),u="vertical-align:middle;padding:0 4px";l&&c.push("<caption>"+l+"</caption>"),c.push('<tr style="'+d+'">');for(var h=0;h<i.length;h++){var p=s.datagrid("getColumnOption",i[h]),f=u+";width:"+p.boxWidth+"px;";f+=";text-align:"+(p.halign||p.align||""),c.push('<td style="'+f+'">'+p.title+"</td>")}return c.push("</tr>"),t.map(a,(function(t){c.push('<tr style="'+d+'">');for(var e=0;e<i.length;e++){var n=i[e],o=s.datagrid("getColumnOption",n),a=t[n];null==a&&(a="");var r=u;r+=";text-align:"+(o.align||""),c.push('<td style="'+r+'">'+a+"</td>")}c.push("</tr>")})),c.push("</table>"),c.join("")}function a(o,a,r,l){a=(a=a||e(o)).concat(r||n(o));for(var i=t(o),s=(l=l||i.datagrid("getColumnFields",!0).concat(i.datagrid("getColumnFields",!1)),[]),c=[],d=0;d<l.length;d++){var u=i.datagrid("getColumnOption",l[d]);c.push(u.title)}return s.push(c),t.map(a,(function(t){for(var e=[],n=0;n<l.length;n++)e.push(t[l[n]]);s.push(e)})),s}function r(t){for(var e=atob(t),n=[],o=0;o<e.length;o+=512){for(var a=e.slice(o,o+512),r=new Array(a.length),l=0;l<a.length;l++)r[l]=a.charCodeAt(l);var i=new Uint8Array(r);n.push(i)}return new Blob(n,{type:""})}t.extend(t.fn.datagrid.methods,{toHtml:function(t,e){return o(t[0],e)},toArray:function(t,e){return a(t[0],e)},toExcel:function(e,n){return e.each((function(){!function(e,n){var a=null,l=null,i=null,s=null,c=null,d="Worksheet";"string"==typeof n?a=n:(a=n.filename,l=n.rows,i=n.footer,s=n.caption,c=n.fields,d=n.worksheet||"Worksheet"),t(e);var u,h=o(e,l,i,s,c),p=(u={worksheet:d,table:h},f='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><meta http-equiv="content-type" content="application/vnd.ms-excel; charset=UTF-8"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e</head><body>{table}</body></html>'.replace(/{(\w+)}/g,(function(t,e){return u[e]})),window.btoa(unescape(encodeURIComponent(f))));var f;if(window.navigator.msSaveBlob){var m=r(p);window.navigator.msSaveBlob(m,a)}else{var g=t('<a style="display:none"></a>').appendTo("body");g[0].href="data:application/vnd.ms-excel;base64,"+p,g[0].download=a,g[0].click(),g.remove()}}(this,n)}))},toCsv:function(e,n){return e.each((function(){!function(e,n){var o=null,l=null,i=null,s=null;"string"==typeof n?o=n:(o=n.filename,l=n.rows,i=n.footer,s=n.fields);var c=a(e,l,i,s),d=t.map(c,(function(t){return t.join(",")})).join("\r\n"),u=window.btoa(unescape(encodeURIComponent(d)));if(window.navigator.msSaveBlob){var h=r(u);window.navigator.msSaveBlob(h,o)}else{var p=t('<a style="display:none"></a>').appendTo("body");p[0].href="data:text/csv;charset=utf-8;base64,"+u,p[0].download=o,p[0].click(),p.remove()}}(this,n)}))},print:function(t,e){return t.each((function(){!function(t,e){var n=null,a=null,r=null,l=null,i=null;"string"==typeof e?n=e:(n=e.title,a=e.rows,r=e.footer,l=e.caption,i=e.fields);var s=window.open("","","width=800, height=500"),c=s.document.open(),d='<!doctype html><html><head><meta charset="utf-8"><title>'+n+"</title></head><body>"+o(t,a,r,l,i)+"</body></html>";c.write(d),c.close(),s.print()}(this,e)}))}})}(jQuery);