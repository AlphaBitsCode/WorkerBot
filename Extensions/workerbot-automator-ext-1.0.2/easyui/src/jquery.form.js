/* Copyright (C) 2023 by WorkerBot.AI */
!function(t){function e(e,a){var i=t.data(e,"form").options;t.extend(i,a||{});var o=t.extend({},i.queryParams);if(0!=i.onSubmit.call(e,o)){var r=t(e).find(".textbox-text:focus");r.triggerHandler("blur"),r.focus();var s=null;if(i.dirty){var d=[];t.map(i.dirtyFields,(function(e){t(e).hasClass("textbox-f")?t(e).next().find(".textbox-value").each((function(){d.push(this)})):t(e).hasClass("checkbox-f")?t(e).next().find(".checkbox-value").each((function(){d.push(this)})):t(e).hasClass("radiobutton-f")?t(e).next().find(".radiobutton-value").each((function(){d.push(this)})):d.push(e)})),(s=t(e).find("input[name]:enabled,textarea[name]:enabled,select[name]:enabled").filter((function(){return-1==t.inArray(this,d)})))._propAttr("disabled",!0)}i.ajax?i.iframe?n(e,o):void 0!==window.FormData?function(e,n){var a=t.data(e,"form").options,i=new FormData(t(e)[0]);for(var o in n)i.append(o,n[o]);t.ajax({url:a.url,type:"post",xhr:function(){var n=t.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",(function(t){if(t.lengthComputable){var n=t.total,i=t.loaded||t.position,o=Math.ceil(100*i/n);a.onProgress.call(e,o)}}),!1),n},data:i,dataType:"html",cache:!1,contentType:!1,processData:!1,complete:function(t){a.success.call(e,t.responseText)}})}(e,o):n(e,o):t(e).submit(),i.dirty&&s._propAttr("disabled",!1)}}function n(e,n){var a=t.data(e,"form").options,i="easyui_frame_"+(new Date).getTime(),o=t("<iframe id="+i+" name="+i+"></iframe>").appendTo("body");function r(){var e=t("#"+i);if(e.length)try{var n=e.contents()[0].readyState;n&&"uninitialized"==n.toLowerCase()&&setTimeout(r,100)}catch(t){d()}}o.attr("src",window.ActiveXObject?"javascript:false":"about:blank"),o.css({position:"absolute",top:-1e3,left:-1e3}),o.bind("load",d),function(n){var o=t(e);a.url&&o.attr("action",a.url);var s=o.attr("target"),d=o.attr("action");o.attr("target",i);var f=t();try{for(var c in n){var u=t('<input type="hidden" name="'+c+'">').val(n[c]).appendTo(o);f=f.add(u)}r(),o[0].submit()}finally{o.attr("action",d),s?o.attr("target",s):o.removeAttr("target"),f.remove()}}(n);var s=10;function d(){var n=t("#"+i);if(n.length){n.unbind();var o="";try{var r=n.contents().find("body");if(""==(o=r.html())&&--s)return void setTimeout(d,100);var f=r.find(">textarea");if(f.length)o=f.val();else{var c=r.find(">pre");c.length&&(o=c.html())}}catch(t){}a.success.call(e,o),setTimeout((function(){n.unbind(),n.remove()}),100)}}}function a(e,n){n=n||{};var a=t.data(e,"form");a?t.extend(a.options,n):t.data(e,"form",{options:t.extend({},t.fn.form.defaults,t.fn.form.parseOptions(e),n)})}function i(e,n){t.data(e,"form").options.novalidate=n,t(e).find(".validatebox-text:not(:disabled)").validatebox(n?"disableValidation":"enableValidation")}t.fn.form=function(n,o){return"string"==typeof n?(this.each((function(){a(this)})),t.fn.form.methods[n](this,o)):this.each((function(){a(this,n),function(n){var a=t.data(n,"form").options;t(n).unbind(".form"),a.ajax&&t(n).bind("submit.form",(function(){return setTimeout((function(){e(n,a)}),0),!1})),t(n).bind("_change.form",(function(e,n){-1==t.inArray(n,a.dirtyFields)&&a.dirtyFields.push(n),a.onChange.call(this,n)})).bind("change.form",(function(e){var n=e.target;t(n).hasClass("textbox-text")||(-1==t.inArray(n,a.dirtyFields)&&a.dirtyFields.push(n),a.onChange.call(this,n))})),i(n,a.novalidate)}(this)}))},t.fn.form.methods={options:function(e){return t.data(e[0],"form").options},submit:function(t,n){return t.each((function(){e(this,n)}))},load:function(e,n){return e.each((function(){!function(e,n){var a=t.data(e,"form").options;if("string"==typeof n){var i={};if(0==a.onBeforeLoad.call(e,i))return;t.ajax({url:n,data:i,dataType:"json",success:function(t){o(t)},error:function(){a.onLoadError.apply(e,arguments)}})}else o(n);function o(n){var i=t(e);for(var o in n){var s=n[o];r(o,s)||d(o,s)||(i.find('input[name="'+o+'"]').val(s),i.find('textarea[name="'+o+'"]').val(s),i.find('select[name="'+o+'"]').val(s))}a.onLoadSuccess.call(e,n),i.form("validate")}function r(n,a){for(var i=["switchbutton","radiobutton","checkbox"],o=0;o<i.length;o++){var r=i[o];if((d=t(e).find("["+r+'Name="'+n+'"]')).length)return d[r]("uncheck"),d.each((function(){s(t(this)[r]("options").value,a)&&t(this)[r]("check")})),!0}var d;return!!(d=t(e).find('input[name="'+n+'"][type=radio], input[name="'+n+'"][type=checkbox]')).length&&(d._propAttr("checked",!1),d.each((function(){s(t(this).val(),a)&&t(this)._propAttr("checked",!0)})),!0)}function s(e,n){return e==String(n)||t.inArray(e,t.isArray(n)?n:[n])>=0}function d(n,i){var o=t(e).find('[textboxName="'+n+'"],[sliderName="'+n+'"]');if(o.length)for(var r=0;r<a.fieldTypes.length;r++){var s=a.fieldTypes[r],d=o.data(s);if(d)return d.options.multiple||d.options.range?o[s]("setValues",i):o[s]("setValue",i),!0}return!1}}(this,n)}))},clear:function(e){return e.each((function(){!function(e){t("input,select,textarea",e).each((function(){if(!t(this).hasClass("textbox-value")){var e=this.type,n=this.tagName.toLowerCase();if("text"==e||"hidden"==e||"password"==e||"textarea"==n)this.value="";else if("file"==e){var a=t(this);if(!a.hasClass("textbox-value")){var i=a.clone().val("");i.insertAfter(a),a.data("validatebox")?(a.validatebox("destroy"),i.validatebox()):a.remove()}}else"checkbox"==e||"radio"==e?this.checked=!1:"select"==n&&(this.selectedIndex=-1)}}));for(var n=t(),a=t(e),i=t.data(e,"form").options,o=0;o<i.fieldTypes.length;o++){var r=i.fieldTypes[o],s=a.find("."+r+"-f").not(n);s.length&&s[r]&&(s[r]("clear"),n=n.add(s))}a.form("validate")}(this)}))},reset:function(e){return e.each((function(){!function(e){e.reset();for(var n=t(e),a=t.data(e,"form").options,i=a.fieldTypes.length-1;i>=0;i--){var o=a.fieldTypes[i],r=n.find("."+o+"-f");r.length&&r[o]&&r[o]("reset")}n.form("validate")}(this)}))},validate:function(e){return function(e){if(t.fn.validatebox){var n=t.data(e,"form").options,a=t(e);a.find(".validatebox-text:not(:disabled)").validatebox("validate");var i=a.find(".validatebox-invalid");return n.focusOnValidate&&i.filter(":not(:disabled):first").focus(),0==i.length}return!0}(e[0])},disableValidation:function(t){return t.each((function(){i(this,!0)}))},enableValidation:function(t){return t.each((function(){i(this,!1)}))},resetValidation:function(e){return e.each((function(){t(this).find(".validatebox-text:not(:disabled)").validatebox("resetValidation")}))},resetDirty:function(e){return e.each((function(){t(this).form("options").dirtyFields=[]}))}},t.fn.form.parseOptions=function(e){var n=t(e);return t.extend({},t.parser.parseOptions(e,[{ajax:"boolean",dirty:"boolean"}]),{url:n.attr("action")?n.attr("action"):void 0})},t.fn.form.defaults={fieldTypes:["tagbox","combobox","combotree","combogrid","combotreegrid","datetimebox","datebox","timepicker","combo","datetimespinner","timespinner","numberspinner","spinner","slider","searchbox","numberbox","passwordbox","filebox","textbox","switchbutton","radiobutton","checkbox"],novalidate:!1,focusOnValidate:!0,ajax:!0,iframe:!0,dirty:!1,dirtyFields:[],url:null,queryParams:{},onSubmit:function(e){return t(this).form("validate")},onProgress:function(t){},success:function(t){},onBeforeLoad:function(t){},onLoadSuccess:function(t){},onLoadError:function(){},onChange:function(t){}}}(jQuery);