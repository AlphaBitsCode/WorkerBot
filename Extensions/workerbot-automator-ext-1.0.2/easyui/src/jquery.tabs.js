/* Copyright (C) 2023 by WorkerBot.AI */
(function($){function getContentWidth(t){var e=0;return $(t).children().each((function(){e+=$(this).outerWidth(!0)})),e}function setScrollers(t){var e=$.data(t,"tabs").options;if(e.showHeader){var s=$(t).children("div.tabs-header"),a=s.children("div.tabs-tool:not(.tabs-tool-hidden)"),i=s.children("div.tabs-scroller-left"),o=s.children("div.tabs-scroller-right"),n=s.children("div.tabs-wrap");if("left"==e.tabPosition||"right"==e.tabPosition){if(!a.length)return;a._outerWidth(s.width());var l={left:"left"==e.tabPosition?"auto":0,right:"left"==e.tabPosition?0:"auto",top:"top"==e.toolPosition?0:"auto",bottom:"top"==e.toolPosition?"auto":0},r={marginTop:"top"==e.toolPosition?a.outerHeight():0};return a.css(l),void n.css(r)}var d=s.outerHeight();e.plain&&(d-=d-s.height()),a._outerHeight(d);var h=getContentWidth(s.find("ul.tabs")),c=s.width()-a._outerWidth();h>c?(i.add(o).show()._outerHeight(d),"left"==e.toolPosition?(a.css({left:i.outerWidth(),right:""}),n.css({marginLeft:i.outerWidth()+a._outerWidth(),marginRight:o._outerWidth(),width:c-i.outerWidth()-o.outerWidth()})):(a.css({left:"",right:o.outerWidth()}),n.css({marginLeft:i.outerWidth(),marginRight:o.outerWidth()+a._outerWidth(),width:c-i.outerWidth()-o.outerWidth()}))):(i.add(o).hide(),"left"==e.toolPosition?(a.css({left:0,right:""}),n.css({marginLeft:a._outerWidth(),marginRight:0,width:c})):(a.css({left:"",right:0}),n.css({marginLeft:0,marginRight:a._outerWidth(),width:c})))}}function addTools(container){var opts=$.data(container,"tabs").options,header=$(container).children("div.tabs-header");if(opts.tools)if("string"==typeof opts.tools)$(opts.tools).addClass("tabs-tool").appendTo(header),$(opts.tools).show();else{header.children("div.tabs-tool").remove();for(var tools=$('<div class="tabs-tool"><table cellspacing="0" cellpadding="0" style="height:100%"><tr></tr></table></div>').appendTo(header),tr=tools.find("tr"),i=0;i<opts.tools.length;i++){var td=$("<td></td>").appendTo(tr),tool=$('<a href="javascript:;"></a>').appendTo(td);tool[0].onclick=eval(opts.tools[i].handler||function(){}),tool.linkbutton($.extend({},opts.tools[i],{plain:!0}))}}else header.children("div.tabs-tool").remove()}function setSize(t,e){var s=$.data(t,"tabs"),a=s.options,i=$(t);if(a.doSize){e&&$.extend(a,{width:e.width,height:e.height}),i._size(a);var o=i.children("div.tabs-header"),n=i.children("div.tabs-panels"),l=o.find("div.tabs-wrap"),r=l.find(".tabs");if(r.children("li").removeClass("tabs-first tabs-last"),r.children("li:first").addClass("tabs-first"),r.children("li:last").addClass("tabs-last"),"left"==a.tabPosition||"right"==a.tabPosition?(o._outerWidth(a.showHeader?a.headerWidth:0),n._outerWidth(i.width()-o.outerWidth()),o.add(n)._size("height",isNaN(parseInt(a.height))?"":i.height()),l._outerWidth(o.width()),r._outerWidth(l.width()).css("height","")):(o.children("div.tabs-scroller-left,div.tabs-scroller-right,div.tabs-tool:not(.tabs-tool-hidden)").css("display",a.showHeader?"block":"none"),o._outerWidth(i.width()).css("height",""),a.showHeader?(o.css("background-color",""),l.css("height","")):(o.css("background-color","transparent"),o._outerHeight(0),l._outerHeight(0)),r._outerHeight(a.tabHeight).css("width",""),r._outerHeight(r.outerHeight()-r.height()-1+a.tabHeight).css("width",""),n._size("height",isNaN(parseInt(a.height))?"":i.height()-o.outerHeight()),n._size("width",i.width())),s.tabs.length){var d=r.outerWidth(!0)-r.width(),h=r.children("li:first"),c=h.outerWidth(!0)-h.width(),b=o.width()-o.children(".tabs-tool:not(.tabs-tool-hidden)")._outerWidth(),p=Math.floor((b-d-c*s.tabs.length)/s.tabs.length);if($.map(s.tabs,(function(t){f(t,a.justified&&$.inArray(a.tabPosition,["top","bottom"])>=0?p:void 0)})),a.justified&&$.inArray(a.tabPosition,["top","bottom"])>=0){var u=b-d-getContentWidth(r);f(s.tabs[s.tabs.length-1],p+u)}}setScrollers(t)}function f(t,e){var s=t.panel("options"),i=s.tab.find(".tabs-inner");(e=e||parseInt(s.tabWidth||a.tabWidth||void 0))?i._outerWidth(e):i.css("width",""),i._outerHeight(a.tabHeight),i.css("lineHeight",i.height()+"px"),i.find(".easyui-fluid:visible").triggerHandler("_resize")}}function setSelectedSize(t){var e=$.data(t,"tabs").options,s=getSelectedTab(t);if(s){var a=$(t).children("div.tabs-panels"),i="auto"==e.width?"auto":a.width(),o="auto"==e.height?"auto":a.height();s.panel("resize",{width:i,height:o})}}function wrapTabs(t){$.data(t,"tabs").tabs;var e=$(t).addClass("tabs-container"),s=$('<div class="tabs-panels"></div>').insertBefore(e);e.children("div").each((function(){s[0].appendChild(this)})),e[0].appendChild(s[0]),$('<div class="tabs-header"><div class="tabs-scroller-left"></div><div class="tabs-scroller-right"></div><div class="tabs-wrap"><ul class="tabs"></ul></div></div>').prependTo(t),e.children("div.tabs-panels").children("div").each((function(e){var s=$.extend({},$.parser.parseOptions(this),{disabled:!!$(this).attr("disabled")||void 0,selected:!!$(this).attr("selected")||void 0});createTab(t,s,$(this))})),e.children("div.tabs-header").find(".tabs-scroller-left, .tabs-scroller-right")._bind("mouseenter",(function(){$(this).addClass("tabs-scroller-over")}))._bind("mouseleave",(function(){$(this).removeClass("tabs-scroller-over")})),e._bind("_resize",(function(e,s){return($(this).hasClass("easyui-fluid")||s)&&(setSize(t),setSelectedSize(t)),!1}))}function bindEvents(t){var e=$.data(t,"tabs"),s=e.options;function a(t){var e=0;return t.parent().children("li").each((function(s){if(t[0]==this)return e=s,!1})),e}$(t).children("div.tabs-header")._unbind()._bind("click",(function(i){if($(i.target).hasClass("tabs-scroller-left"))$(t).tabs("scrollBy",-s.scrollIncrement);else{if(!$(i.target).hasClass("tabs-scroller-right")){var o=$(i.target).closest("li");if(o.hasClass("tabs-disabled"))return!1;if($(i.target).closest(".tabs-close").length)closeTab(t,a(o));else if(o.length){var n=a(o),l=e.tabs[n].panel("options");l.collapsible?l.closed?selectTab(t,n):unselectTab(t,n):selectTab(t,n)}return!1}$(t).tabs("scrollBy",s.scrollIncrement)}}))._bind("contextmenu",(function(e){var i=$(e.target).closest("li");i.hasClass("tabs-disabled")||i.length&&s.onContextMenu.call(t,e,i.find("span.tabs-title").html(),a(i))}))}function setProperties(t){var e=$.data(t,"tabs").options,s=$(t).children("div.tabs-header"),a=$(t).children("div.tabs-panels");s.removeClass("tabs-header-top tabs-header-bottom tabs-header-left tabs-header-right"),a.removeClass("tabs-panels-top tabs-panels-bottom tabs-panels-left tabs-panels-right"),"top"==e.tabPosition?s.insertBefore(a):"bottom"==e.tabPosition?(s.insertAfter(a),s.addClass("tabs-header-bottom"),a.addClass("tabs-panels-top")):"left"==e.tabPosition?(s.addClass("tabs-header-left"),a.addClass("tabs-panels-right")):"right"==e.tabPosition&&(s.addClass("tabs-header-right"),a.addClass("tabs-panels-left")),1==e.plain?s.addClass("tabs-header-plain"):s.removeClass("tabs-header-plain"),s.removeClass("tabs-header-narrow").addClass(e.narrow?"tabs-header-narrow":"");var i=s.find(".tabs");i.removeClass("tabs-pill").addClass(e.pill?"tabs-pill":""),i.removeClass("tabs-narrow").addClass(e.narrow?"tabs-narrow":""),i.removeClass("tabs-justified").addClass(e.justified?"tabs-justified":""),1==e.border?(s.removeClass("tabs-header-noborder"),a.removeClass("tabs-panels-noborder")):(s.addClass("tabs-header-noborder"),a.addClass("tabs-panels-noborder")),e.doSize=!0}function createTab(t,e,s){e=e||{};var a=$.data(t,"tabs"),i=a.tabs;(null==e.index||e.index>i.length)&&(e.index=i.length),e.index<0&&(e.index=0);var o=$(t).children("div.tabs-header").find("ul.tabs"),n=$(t).children("div.tabs-panels"),l=$('<li><span class="tabs-inner"><span class="tabs-title"></span><span class="tabs-icon"></span></span></li>');s||(s=$("<div></div>")),e.index>=i.length?(l.appendTo(o),s.appendTo(n),i.push(s)):(l.insertBefore(o.children("li:eq("+e.index+")")),s.insertBefore(n.children("div.panel:eq("+e.index+")")),i.splice(e.index,0,s)),s.panel($.extend({},e,{tab:l,border:!1,noheader:!0,closed:!0,doSize:!1,iconCls:e.icon?e.icon:void 0,onLoad:function(){e.onLoad&&e.onLoad.apply(this,arguments),a.options.onLoad.call(t,$(this))},onBeforeOpen:function(){if(e.onBeforeOpen&&0==e.onBeforeOpen.call(this))return!1;var s=$(t).tabs("getSelected");if(s){if(s[0]==this)return setSelectedSize(t),!1;if($(t).tabs("unselect",getTabIndex(t,s)),s=$(t).tabs("getSelected"))return!1}var a=$(this).panel("options");a.tab.addClass("tabs-selected");var i=$(t).find(">div.tabs-header>div.tabs-wrap"),o=a.tab.position().left,n=o+a.tab.outerWidth();if(o<0||n>i.width()){var l=o-(i.width()-a.tab.width())/2;$(t).tabs("scrollBy",l)}else $(t).tabs("scrollBy",0);var r=$(this).panel("panel");r.css("display","block"),setSelectedSize(t),r.css("display","none")},onOpen:function(){e.onOpen&&e.onOpen.call(this);var s=$(this).panel("options"),i=getTabIndex(t,this);a.selectHis.push(i),a.options.onSelect.call(t,s.title,i)},onBeforeClose:function(){if(e.onBeforeClose&&0==e.onBeforeClose.call(this))return!1;$(this).panel("options").tab.removeClass("tabs-selected")},onClose:function(){e.onClose&&e.onClose.call(this);var s=$(this).panel("options");a.options.onUnselect.call(t,s.title,getTabIndex(t,this))}})),$(t).tabs("update",{tab:s,options:s.panel("options"),type:"header"})}function addTab(t,e){var s=$.data(t,"tabs").options;null==e.selected&&(e.selected=!0),createTab(t,e),s.onAdd.call(t,e.title,e.index),e.selected&&selectTab(t,e.index)}function updateTab(t,e){e.type=e.type||"all";$.data(t,"tabs").selectHis;var s=e.tab,a=s.panel("options");a.title;if($.extend(a,e.options,{iconCls:e.options.icon?e.options.icon:void 0}),"all"!=e.type&&"body"!=e.type||s.panel(),"all"==e.type||"header"==e.type){var i=a.tab;if(a.header)i.find(".tabs-inner").html($(a.header));else{var o=i.find("span.tabs-title"),n=i.find("span.tabs-icon");if(o.html(a.title),n.attr("class","tabs-icon"),i.find(".tabs-close").remove(),a.closable?(o.addClass("tabs-closable"),$('<span class="tabs-close"></span>').appendTo(i)):o.removeClass("tabs-closable"),a.iconCls?(o.addClass("tabs-with-icon"),n.addClass(a.iconCls)):o.removeClass("tabs-with-icon"),a.tools){if(!(l=i.find("span.tabs-p-tool")).length)var l=$('<span class="tabs-p-tool"></span>').insertAfter(i.find(".tabs-inner"));if($.isArray(a.tools)){l.empty();for(var r=0;r<a.tools.length;r++){var d=$('<a href="javascript:;"></a>').appendTo(l);d.addClass(a.tools[r].iconCls),a.tools[r].handler&&d._bind("click",{handler:a.tools[r].handler},(function(t){$(this).parents("li").hasClass("tabs-disabled")||t.data.handler.call(this)}))}}else $(a.tools).children().appendTo(l);var h=12*l.children().length;a.closable?(h+=8,l.css("right","")):(h-=3,l.css("right","5px")),o.css("padding-right",h+"px")}else i.find("span.tabs-p-tool").remove(),o.css("padding-right","")}}a.disabled?a.tab.addClass("tabs-disabled"):a.tab.removeClass("tabs-disabled"),setSize(t),$.data(t,"tabs").options.onUpdate.call(t,a.title,getTabIndex(t,s))}function closeTab(t,e){var s=$.data(t,"tabs"),a=s.options,i=(s.tabs,s.selectHis);if(exists(t,e)){var o=(l=getTab(t,e)).panel("options").title,n=getTabIndex(t,l);if(0!=a.onBeforeClose.call(t,o,n)){var l;(l=getTab(t,e,!0)).panel("options").tab.remove(),l.panel("destroy"),a.onClose.call(t,o,n),setSize(t);for(var r=[],d=0;d<i.length;d++){var h=i[d];h!=n&&r.push(h>n?h-1:h)}s.selectHis=r,!$(t).tabs("getSelected")&&r.length&&(n=s.selectHis.pop(),$(t).tabs("select",n))}}}function getTab(t,e,s){var a=$.data(t,"tabs").tabs,i=null;if("number"==typeof e)e>=0&&e<a.length&&(i=a[e],s&&a.splice(e,1));else{for(var o=$("<span></span>"),n=0;n<a.length;n++){var l=a[n];o.html(l.panel("options").title);var r=o.text();if(o.html(e),r==(e=o.text())){i=l,s&&a.splice(n,1);break}}o.remove()}return i}function getTabIndex(t,e){for(var s=$.data(t,"tabs").tabs,a=0;a<s.length;a++)if(s[a][0]==$(e)[0])return a;return-1}function getSelectedTab(t){for(var e=$.data(t,"tabs").tabs,s=0;s<e.length;s++){var a=e[s];if(a.panel("options").tab.hasClass("tabs-selected"))return a}return null}function doFirstSelect(t){for(var e=$.data(t,"tabs"),s=e.tabs,a=0;a<s.length;a++){var i=s[a].panel("options");if(i.selected&&!i.disabled)return void selectTab(t,a)}selectTab(t,e.options.selected)}function selectTab(t,e){var s=getTab(t,e);s&&!s.is(":visible")&&(stopAnimate(t),s.panel("options").disabled||s.panel("open"))}function unselectTab(t,e){var s=getTab(t,e);s&&s.is(":visible")&&(stopAnimate(t),s.panel("close"))}function stopAnimate(t){$(t).children("div.tabs-panels").each((function(){$(this).stop(!0,!0)}))}function exists(t,e){return null!=getTab(t,e)}function showHeader(t,e){$.data(t,"tabs").options.showHeader=e,$(t).tabs("resize")}function showTool(t,e){var s=$(t).find(">.tabs-header>.tabs-tool");e?s.removeClass("tabs-tool-hidden").show():s.addClass("tabs-tool-hidden").hide(),$(t).tabs("resize").tabs("scrollBy",0)}$.fn.tabs=function(t,e){return"string"==typeof t?$.fn.tabs.methods[t](this,e):(t=t||{},this.each((function(){var e=$.data(this,"tabs");e?$.extend(e.options,t):($.data(this,"tabs",{options:$.extend({},$.fn.tabs.defaults,$.fn.tabs.parseOptions(this),t),tabs:[],selectHis:[]}),wrapTabs(this)),addTools(this),setProperties(this),setSize(this),bindEvents(this),doFirstSelect(this)})))},$.fn.tabs.methods={options:function(t){var e=t[0],s=$.data(e,"tabs").options,a=getSelectedTab(e);return s.selected=a?getTabIndex(e,a):-1,s},tabs:function(t){return $.data(t[0],"tabs").tabs},resize:function(t,e){return t.each((function(){setSize(this,e),setSelectedSize(this)}))},add:function(t,e){return t.each((function(){addTab(this,e)}))},close:function(t,e){return t.each((function(){closeTab(this,e)}))},getTab:function(t,e){return getTab(t[0],e)},getTabIndex:function(t,e){return getTabIndex(t[0],e)},getSelected:function(t){return getSelectedTab(t[0])},select:function(t,e){return t.each((function(){selectTab(this,e)}))},unselect:function(t,e){return t.each((function(){unselectTab(this,e)}))},exists:function(t,e){return exists(t[0],e)},update:function(t,e){return t.each((function(){updateTab(this,e)}))},enableTab:function(t,e){return t.each((function(){var t=$(this).tabs("getTab",e).panel("options");t.tab.removeClass("tabs-disabled"),t.disabled=!1}))},disableTab:function(t,e){return t.each((function(){var t=$(this).tabs("getTab",e).panel("options");t.tab.addClass("tabs-disabled"),t.disabled=!0}))},showHeader:function(t){return t.each((function(){showHeader(this,!0)}))},hideHeader:function(t){return t.each((function(){showHeader(this,!1)}))},showTool:function(t){return t.each((function(){showTool(this,!0)}))},hideTool:function(t){return t.each((function(){showTool(this,!1)}))},scrollBy:function(t,e){return t.each((function(){var t,s,a=$(this).tabs("options"),i=$(this).find(">div.tabs-header>div.tabs-wrap"),o=Math.min(i._scrollLeft()+e,(t=0,(s=i.children("ul")).children("li").each((function(){t+=$(this).outerWidth(!0)})),t-i.width()+(s.outerWidth()-s.width())));i.animate({scrollLeft:o},a.scrollDuration)}))}},$.fn.tabs.parseOptions=function(t){return $.extend({},$.parser.parseOptions(t,["tools","toolPosition","tabPosition",{fit:"boolean",border:"boolean",plain:"boolean"},{headerWidth:"number",tabWidth:"number",tabHeight:"number",selected:"number"},{showHeader:"boolean",justified:"boolean",narrow:"boolean",pill:"boolean"}]))},$.fn.tabs.defaults={width:"auto",height:"auto",headerWidth:150,tabWidth:"auto",tabHeight:32,selected:0,showHeader:!0,plain:!1,fit:!1,border:!0,justified:!1,narrow:!1,pill:!1,tools:null,toolPosition:"right",tabPosition:"top",scrollIncrement:100,scrollDuration:400,onLoad:function(t){},onSelect:function(t,e){},onUnselect:function(t,e){},onBeforeClose:function(t,e){},onClose:function(t,e){},onAdd:function(t,e){},onUpdate:function(t,e){},onContextMenu:function(t,e,s){}}})(jQuery);