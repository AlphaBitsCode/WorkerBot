/* Copyright (C) 2023 by WorkerBot.AI */
(function($){function init(e){var t=$.data(e,"menu").options;$(e).addClass("menu-top"),t.inline?$(e).addClass("menu-inline"):$(e).appendTo("body"),$(e)._bind("_resize",(function(t,n){return($(this).hasClass("easyui-fluid")||n)&&$(e).menu("resize",e),!1}));for(var n=function e(t){var n=[];t.addClass("menu"),n.push(t),t.hasClass("menu-content")||t.children("div").each((function(){var t=$(this).children("div");if(t.length){t.appendTo("body"),this.submenu=t;var i=e(t);n=n.concat(i)}}));return n}($(e)),i=0;i<n.length;i++)createMenu(e,n[i])}function createMenu(e,t){var n=$(t).addClass("menu");n.data("menu")||n.data("menu",{options:$.parser.parseOptions(n[0],["width","height"])}),n.hasClass("menu-content")||(n.children("div").each((function(){createItem(e,this)})),$('<div class="menu-line"></div>').prependTo(n)),setMenuSize(e,n),n.hasClass("menu-inline")||n.hide(),bindMenuEvent(e,n)}function createItem(target,div,options){var item=$(div),itemOpts=$.extend({},$.parser.parseOptions(item[0],["id","name","iconCls","href",{separator:"boolean"}]),{disabled:!!item.attr("disabled")||void 0,text:$.trim(item.html()),onclick:item[0].onclick},options||{});itemOpts.onclick=itemOpts.onclick||itemOpts.handler||null,item.data("menuitem",{options:itemOpts}),itemOpts.separator&&item.addClass("menu-sep"),item.hasClass("menu-sep")||(item.addClass("menu-item"),item.empty().append($('<div class="menu-text"></div>').html(itemOpts.text)),itemOpts.iconCls&&$('<div class="menu-icon"></div>').addClass(itemOpts.iconCls).appendTo(item),itemOpts.id&&item.attr("id",itemOpts.id),itemOpts.onclick&&("string"==typeof itemOpts.onclick?item.attr("onclick",itemOpts.onclick):item[0].onclick=eval(itemOpts.onclick)),itemOpts.disabled&&setDisabled(target,item[0],!0),item[0].submenu&&$('<div class="menu-rightarrow"></div>').appendTo(item))}function setMenuSize(e,t){var n=$.data(e,"menu").options,i=t.attr("style")||"",o=t.is(":visible");t.css({display:"block",left:-1e4,height:"auto",overflow:"hidden"}),t.find(".menu-item").each((function(){$(this)._outerHeight(n.itemHeight),$(this).find(".menu-text").css({height:n.itemHeight-2+"px",lineHeight:n.itemHeight-2+"px"})})),t.removeClass("menu-noline").addClass(n.noline?"menu-noline":"");var s=t.data("menu").options,u=s.width,a=s.height;isNaN(parseInt(u))&&(u=0,t.find("div.menu-text").each((function(){u<$(this).outerWidth()&&(u=$(this).outerWidth())})),u=u?u+40:"");var d=Math.round(t.outerHeight());if(isNaN(parseInt(a)))if(a=d,t.hasClass("menu-top")&&n.alignTo){var r=$(n.alignTo),m=r.offset().top-$(document).scrollTop(),l=$(window)._outerHeight()+$(document).scrollTop()-r.offset().top-r._outerHeight();a=Math.min(a,Math.max(m,l))}else a>$(window)._outerHeight()&&(a=$(window).height());t.attr("style",i),t.show(),t._size($.extend({},s,{width:u,height:a,minWidth:s.minWidth||n.minWidth,maxWidth:s.maxWidth||n.maxWidth})),t.find(".easyui-fluid").triggerHandler("_resize",[!0]),t.css("overflow",t.outerHeight()<d?"auto":"hidden"),t.children("div.menu-line")._outerHeight(d-2),o||t.hide()}function bindMenuEvent(e,t){var n=$.data(e,"menu").options;for(var i in t._unbind(".menu"),n.events)t._bind(i+".menu",{target:e},n.events[i])}function mouseenterHandler(e){var t=e.data.target,n=$.data(t,"menu");n.timer&&(clearTimeout(n.timer),n.timer=null)}function mouseleaveHandler(e){var t=e.data.target,n=$.data(t,"menu");n.options.hideOnUnhover&&(n.timer=setTimeout((function(){hideAll(t,$(t).hasClass("menu-inline"))}),n.options.duration))}function mouseoverHandler(e){var t=e.data.target,n=$(e.target).closest(".menu-item");if(n.length){if(n.siblings().each((function(){this.submenu&&hideMenu(this.submenu),$(this).removeClass("menu-active")})),n.addClass("menu-active"),n.hasClass("menu-item-disabled"))return void n.addClass("menu-active-disabled");var i=n[0].submenu;i&&$(t).menu("show",{menu:i,parent:n})}}function mouseoutHandler(e){var t=$(e.target).closest(".menu-item");if(t.length){t.removeClass("menu-active menu-active-disabled");var n=t[0].submenu;n?e.pageX>=parseInt(n.css("left"))?t.addClass("menu-active"):hideMenu(n):t.removeClass("menu-active")}}function clickHandler(e){var t=e.data.target,n=$(e.target).closest(".menu-item");if(n.length){var i=$(t).data("menu").options,o=n.data("menuitem").options;if(o.disabled)return;n[0].submenu||(hideAll(t,i.inline),o.href&&(location.href=o.href)),n.trigger("mouseenter"),i.onClick.call(t,$(t).menu("getItem",n[0]))}}function hideAll(e,t){var n=$.data(e,"menu");return n&&$(e).is(":visible")&&(hideMenu($(e)),t?$(e).show():n.options.onHide.call(e)),!1}function showMenu(e,t){var n,i;t=t||{};var o=$.data(e,"menu").options,s=$(t.menu||e);if($(e).menu("resize",s[0]),s.hasClass("menu-top")){if($.extend(o,t),n=o.left,i=o.top,o.alignTo){var u=$(o.alignTo);n=u.offset().left,i=u.offset().top+u._outerHeight(),"right"==o.align&&(n+=u.outerWidth()-s.outerWidth())}n+s.outerWidth()>$(window)._outerWidth()+$(document)._scrollLeft()&&(n=$(window)._outerWidth()+$(document).scrollLeft()-s.outerWidth()-5),n<0&&(n=0),i=d(i,o.alignTo)}else{var a=t.parent;(n=a.offset().left+a.outerWidth()-2)+s.outerWidth()+5>$(window)._outerWidth()+$(document).scrollLeft()&&(n=a.offset().left-s.outerWidth()+2),i=d(a.offset().top-3)}function d(e,t){return e+s.outerHeight()>$(window)._outerHeight()+$(document).scrollTop()&&(e=t?$(t).offset().top-s._outerHeight():$(window)._outerHeight()+$(document).scrollTop()-s.outerHeight()),e<0&&(e=0),e}s.css(o.position.call(e,s[0],n,i)),s.show(0,(function(){s[0].shadow||(s[0].shadow=$('<div class="menu-shadow"></div>').insertAfter(s)),s[0].shadow.css({display:s.hasClass("menu-inline")?"none":"block",zIndex:$.fn.menu.defaults.zIndex++,left:s.css("left"),top:s.css("top"),width:s.outerWidth(),height:s.outerHeight()}),s.css("z-index",$.fn.menu.defaults.zIndex++),s.hasClass("menu-top")&&o.onShow.call(e)}))}function hideMenu(e){e&&e.length&&(!function(e){e.stop(!0,!0),e[0].shadow&&e[0].shadow.hide();e.hide()}(e),e.find("div.menu-item").each((function(){this.submenu&&hideMenu(this.submenu),$(this).removeClass("menu-active")})))}function findItems(e,t){var n=$.isFunction(t)?t:function(e){for(var n in t)if(e[n]!=t[n])return!1;return!0},i=[];return navItems(e,(function(t){1==n.call(e,t)&&i.push(t)})),i}function navItems(e,t){var n=!1;!function i(o){o.children("div.menu-item").each((function(){if(!n){var o=$(e).menu("getItem",this);0==t.call(e,o)&&(n=!0),this.submenu&&!n&&i(this.submenu)}}))}($(e))}function setDisabled(e,t,n){var i=$(t);if(i.hasClass("menu-item")){var o=i.data("menuitem").options;o.disabled=n,n?(i.addClass("menu-item-disabled"),i[0].onclick=null):(i.removeClass("menu-item-disabled"),i[0].onclick=o.onclick)}}function appendItems(e,t,n){for(var i=0;i<t.length;i++){var o=$.extend({},t[i],{parent:n});o.children&&o.children.length?(o.id=o.id||"menu_id_"+$.fn.menu.defaults.zIndex++,appendItem(e,o),appendItems(e,o.children,$("#"+o.id)[0])):appendItem(e,o)}}function appendItem(e,t){$.data(e,"menu").options;var n=$(e);if(t.parent){if(!t.parent.submenu){var i=$("<div></div>").appendTo("body");t.parent.submenu=i,$('<div class="menu-rightarrow"></div>').appendTo(t.parent),createMenu(e,i)}n=t.parent.submenu}createItem(e,$("<div></div>").appendTo(n),t)}function removeItem(e,t){!function e(t){if(t.submenu){t.submenu.children("div.menu-item").each((function(){e(this)}));var n=t.submenu[0].shadow;n&&n.remove(),t.submenu.remove()}$(t).remove()}(t)}function setVisible(e,t,n){var i=$(t).parent();n?$(t).show():$(t).hide(),setMenuSize(e,i)}function destroyMenu(e){$(e).children("div.menu-item").each((function(){removeItem(e,this)})),e.shadow&&e.shadow.remove(),$(e).remove()}$((function(){$(document)._unbind(".menu")._bind("mousedown.menu",(function(e){$(e.target).closest("div.menu,div.combo-p").length||($("body>div.menu-top:visible").not(".menu-inline").menu("hide"),hideMenu($("body>div.menu:visible").not(".menu-inline")))}))})),$.fn.menu=function(e,t){return"string"==typeof e?$.fn.menu.methods[e](this,t):(e=e||{},this.each((function(){var t=$.data(this,"menu");t?$.extend(t.options,e):(t=$.data(this,"menu",{options:$.extend({},$.fn.menu.defaults,$.fn.menu.parseOptions(this),e)}),init(this)),$(this).css({left:t.options.left,top:t.options.top})})))},$.fn.menu.methods={options:function(e){return $.data(e[0],"menu").options},show:function(e,t){return e.each((function(){showMenu(this,t)}))},hide:function(e){return e.each((function(){hideAll(this)}))},clear:function(e){return e.each((function(){var e=this;$(e).children(".menu-item,.menu-sep").each((function(){removeItem(e,this)}))}))},destroy:function(e){return e.each((function(){destroyMenu(this)}))},setText:function(e,t){return e.each((function(){$(t.target).data("menuitem").options.text=t.text,$(t.target).children("div.menu-text").html(t.text)}))},setIcon:function(e,t){return e.each((function(){$(t.target).data("menuitem").options.iconCls=t.iconCls,$(t.target).children("div.menu-icon").remove(),t.iconCls&&$('<div class="menu-icon"></div>').addClass(t.iconCls).appendTo(t.target)}))},getItem:function(e,t){var n=$(t).data("menuitem").options;return $.extend({},n,{target:$(t)[0]})},findItem:function(e,t){var n=e.menu("findItems",t);return n.length?n[0]:null},findItems:function(e,t){return findItems(e[0],"string"==typeof t?function(e){return $("<div>"+e.text+"</div>").text()==t}:t)},navItems:function(e,t){return e.each((function(){navItems(this,t)}))},appendItems:function(e,t){return e.each((function(){appendItems(this,t)}))},appendItem:function(e,t){return e.each((function(){appendItem(this,t)}))},removeItem:function(e,t){return e.each((function(){removeItem(this,t)}))},enableItem:function(e,t){return e.each((function(){setDisabled(this,t,!1)}))},disableItem:function(e,t){return e.each((function(){setDisabled(this,t,!0)}))},showItem:function(e,t){return e.each((function(){setVisible(this,t,!0)}))},hideItem:function(e,t){return e.each((function(){setVisible(this,t,!1)}))},resize:function(e,t){return e.each((function(){setMenuSize(this,$(t||this))}))}},$.fn.menu.parseOptions=function(e){return $.extend({},$.parser.parseOptions(e,[{minWidth:"number",itemHeight:"number",duration:"number",hideOnUnhover:"boolean"},{fit:"boolean",inline:"boolean",noline:"boolean"}]))},$.fn.menu.defaults={zIndex:11e4,left:0,top:0,alignTo:null,align:"left",minWidth:150,itemHeight:32,duration:100,hideOnUnhover:!0,inline:!1,fit:!1,noline:!1,events:{mouseenter:mouseenterHandler,mouseleave:mouseleaveHandler,mouseover:mouseoverHandler,mouseout:mouseoutHandler,click:clickHandler},position:function(e,t,n){return{left:t,top:n}},onShow:function(){},onHide:function(){},onClick:function(e){}}})(jQuery);