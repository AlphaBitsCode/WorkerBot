/* Copyright (C) 2023 by WorkerBot.AI */
(function($){function init(e){var t=$('<div class="slider"><div class="slider-inner"><a href="javascript:;" class="slider-handle"></a><span class="slider-tip"></span></div><div class="slider-rule"></div><div class="slider-rulelabel"></div><div style="clear:both"></div><input type="hidden" class="slider-value"></div>').insertAfter(e),i=$(e);i.addClass("slider-f").hide();var a=i.attr("name");return a&&(t.find("input.slider-value").attr("name",a),i.removeAttr("name").attr("sliderName",a)),t._bind("_resize",(function(t,i){return($(this).hasClass("easyui-fluid")||i)&&setSize(e),!1})),t}function setSize(e,t){var i=$.data(e,"slider"),a=i.options,r=i.slider;t&&(t.width&&(a.width=t.width),t.height&&(a.height=t.height)),r._size(a),"h"==a.mode?(r.css("height",""),r.children("div").css("height","")):(r.css("width",""),r.children("div").css("width",""),r.children("div.slider-rule,div.slider-rulelabel,div.slider-inner")._outerHeight(r._outerHeight())),initValue(e)}function showRule(e){var t=$.data(e,"slider"),i=t.options,a=t.slider,r="h"==i.mode?i.rule:i.rule.slice(0).reverse();i.reversed&&(r=r.slice(0).reverse()),function(e){var t=a.find("div.slider-rule"),r=a.find("div.slider-rulelabel");t.empty(),r.empty();for(var s=0;s<e.length;s++){var n=100*s/(e.length-1)+"%",l=$("<span></span>").appendTo(t);l.css("h"==i.mode?"left":"top",n),"|"!=e[s]&&((l=$("<span></span>").appendTo(r)).html(e[s]),"h"==i.mode?l.css({left:n,marginLeft:-Math.round(l.outerWidth()/2)}):l.css({top:n,marginTop:-Math.round(l.outerHeight()/2)}))}}(r)}function buildSlider(e){var t=$.data(e,"slider"),i=t.options,a=t.slider;a.removeClass("slider-h slider-v slider-disabled"),a.addClass("h"==i.mode?"slider-h":"slider-v"),a.addClass(i.disabled?"slider-disabled":"");var r=a.find(".slider-inner");function s(t,a){var r=pos2value(e,t),s=Math.abs(r%i.step);if(r>=0?s<i.step/2?r-=s:r=r-s+i.step:s<i.step/2?r+=s:r=r+s-i.step,r=function(e){var t=String(i.step).split("."),a=t.length>1?t[1].length:0;return parseFloat(e.toFixed(a))}(r),i.range){var n=i.value[0],l=i.value[1],d=parseFloat((n+l)/2);if(a){var o=$(a).nextAll(".slider-handle").length>0;r<=l&&o?n=r:r>=n&&!o&&(l=r)}else r<n?n=r:r>l?l=r:r<d?n=r:l=r;$(e).slider("setValues",[n,l])}else $(e).slider("setValue",r)}r.html('<a href="javascript:;" class="slider-handle"></a><span class="slider-tip"></span>'),i.range&&r.append('<a href="javascript:;" class="slider-handle"></a><span class="slider-tip"></span>'),a.find("a.slider-handle").draggable({axis:i.mode,cursor:"pointer",disabled:i.disabled,onDrag:function(e){var t=e.data.left,r=a.width();return"h"!=i.mode&&(t=e.data.top,r=a.height()),t<0||t>r||s(t,this),!1},onStartDrag:function(){t.isDragging=!0,i.onSlideStart.call(e,i.value)},onStopDrag:function(a){s("h"==i.mode?a.data.left:a.data.top,this),i.onSlideEnd.call(e,i.value),i.onComplete.call(e,i.value),t.isDragging=!1}}),a.find("div.slider-inner")._unbind(".slider")._bind("mousedown.slider",(function(a){if(!t.isDragging&&!i.disabled){var r=$(this).offset();s("h"==i.mode?a.pageX-r.left:a.pageY-r.top),i.onComplete.call(e,i.value)}}))}function setValues(e,t){var i=$.data(e,"slider"),a=i.options,r=i.slider,s=$.isArray(a.value)?a.value:[a.value],n=[];$.isArray(t)||(t=$.map(String(t).split(a.separator),(function(e){return parseFloat(e)}))),r.find(".slider-value").remove();for(var l=$(e).attr("sliderName")||"",d=0;d<t.length;d++){var o=t[d];o<a.min&&(o=a.min),o>a.max&&(o=a.max);var u=$('<input type="hidden" class="slider-value">').appendTo(r);u.attr("name",l),u.val(o),n.push(o);var h=r.find(".slider-handle:eq("+d+")"),p=h.next(),v=value2pos(e,o);if(a.showTip?(p.show(),p.html(a.tipFormatter.call(e,o))):p.hide(),"h"==a.mode){var c="left:"+v+"px;";h.attr("style",c),p.attr("style",c+"margin-left:"+-Math.round(p.outerWidth()/2)+"px")}else{c="top:"+v+"px;";h.attr("style",c),p.attr("style",c+"margin-left:"+-Math.round(p.outerWidth())+"px")}}a.value=a.range?n:n[0],$(e).val(a.range?n.join(a.separator):n[0]),s.join(",")!=n.join(",")&&a.onChange.call(e,a.value,a.range?s:s[0])}function initValue(e){var t=$.data(e,"slider").options,i=t.onChange;t.onChange=function(){},setValues(e,t.value),t.onChange=i}function value2pos(e,t){var i=$.data(e,"slider"),a=i.options,r=i.slider,s="h"==a.mode?r.width():r.height(),n=a.converter.toPosition.call(e,t,s);return"v"==a.mode&&(n=r.height()-n),a.reversed&&(n=s-n),n}function pos2value(e,t){var i=$.data(e,"slider"),a=i.options,r=i.slider,s="h"==a.mode?r.width():r.height();t="h"==a.mode?a.reversed?s-t:t:a.reversed?t:s-t;return a.converter.toValue.call(e,t,s)}$.fn.slider=function(e,t){return"string"==typeof e?$.fn.slider.methods[e](this,t):(e=e||{},this.each((function(){var t=$.data(this,"slider");t?$.extend(t.options,e):(t=$.data(this,"slider",{options:$.extend({},$.fn.slider.defaults,$.fn.slider.parseOptions(this),e),slider:init(this)}),$(this)._propAttr("disabled",!1));var i=t.options;i.min=parseFloat(i.min),i.max=parseFloat(i.max),i.range?($.isArray(i.value)||(i.value=$.map(String(i.value).split(i.separator),(function(e){return parseFloat(e)}))),i.value.length<2&&i.value.push(i.max)):i.value=parseFloat(i.value),i.step=parseFloat(i.step),i.originalValue=i.value,buildSlider(this),showRule(this),setSize(this)})))},$.fn.slider.methods={options:function(e){return $.data(e[0],"slider").options},destroy:function(e){return e.each((function(){$.data(this,"slider").slider.remove(),$(this).remove()}))},resize:function(e,t){return e.each((function(){setSize(this,t)}))},getValue:function(e){return e.slider("options").value},getValues:function(e){return e.slider("options").value},setValue:function(e,t){return e.each((function(){setValues(this,[t])}))},setValues:function(e,t){return e.each((function(){setValues(this,t)}))},clear:function(e){return e.each((function(){var e=$(this).slider("options");setValues(this,e.range?[e.min,e.max]:[e.min])}))},reset:function(e){return e.each((function(){var e=$(this).slider("options");$(this).slider(e.range?"setValues":"setValue",e.originalValue)}))},enable:function(e){return e.each((function(){$.data(this,"slider").options.disabled=!1,buildSlider(this)}))},disable:function(e){return e.each((function(){$.data(this,"slider").options.disabled=!0,buildSlider(this)}))}},$.fn.slider.parseOptions=function(target){var t=$(target);return $.extend({},$.parser.parseOptions(target,["width","height","mode",{reversed:"boolean",showTip:"boolean",range:"boolean",min:"number",max:"number",step:"number"}]),{value:t.val()||void 0,disabled:!!t.attr("disabled")||void 0,rule:t.attr("rule")?eval(t.attr("rule")):void 0})},$.fn.slider.defaults={width:"auto",height:"auto",mode:"h",reversed:!1,showTip:!1,disabled:!1,range:!1,value:0,separator:",",min:0,max:100,step:1,rule:[],tipFormatter:function(e){return e},converter:{toPosition:function(e,t){var i=$(this).slider("options");return(e-i.min)/(i.max-i.min)*t},toValue:function(e,t){var i=$(this).slider("options");return i.min+(i.max-i.min)*(e/t)}},onChange:function(e,t){},onSlideStart:function(e){},onSlideEnd:function(e){},onComplete:function(e){}}})(jQuery);