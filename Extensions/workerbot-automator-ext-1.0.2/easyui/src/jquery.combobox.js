/* Copyright (C) 2023 by WorkerBot.AI */
!function(o){function e(e,t){var i=o.data(e,"combobox");return o.easyui.indexOfArray(i.data,i.options.valueField,t)}function t(e,t){var n=o.data(e,"combobox").options,a=o(e).combobox("panel"),r=a.children("div.combobox-item-hover");r.length||(r=a.children("div.combobox-item-selected")),r.removeClass("combobox-item-hover");var s="div.combobox-item:visible:not(.combobox-item-disabled):first",l="div.combobox-item:visible:not(.combobox-item-disabled):last";if(r.length?"next"==t?(r=r.nextAll(s)).length||(r=a.children(s)):(r=r.prevAll(s)).length||(r=a.children(l)):r=a.children("next"==t?s:l),r.length){r.addClass("combobox-item-hover");var c=n.finder.getRow(e,r);c&&(o(e).combobox("scrollTo",c[n.valueField]),n.selectOnNavigation&&i(e,c[n.valueField]))}}function i(e,t,i){var n=o.data(e,"combobox").options,r=o(e).combo("getValues");-1==o.inArray(t+"",r)&&(n.multiple?r.push(t):r=[t],a(e,r,i))}function n(e,t){o.data(e,"combobox").options;var i=o(e).combo("getValues"),n=o.inArray(t+"",i);n>=0&&(i.splice(n,1),a(e,i))}function a(e,t,i){var n=o.data(e,"combobox").options,a=o(e).combo("panel");o.isArray(t)||(t=t.split(n.separator)),n.multiple||(t=t.length?[t[0]]:[""]);var r=o(e).combo("getValues");a.is(":visible")&&a.find(".combobox-item-selected").each((function(){var t=n.finder.getRow(e,o(this));t&&-1==o.easyui.indexOfArray(r,t[n.valueField])&&o(this).removeClass("combobox-item-selected")})),o.map(r,(function(i){if(-1==o.easyui.indexOfArray(t,i)){var a=n.finder.getEl(e,i);a.hasClass("combobox-item-selected")&&(a.removeClass("combobox-item-selected"),n.onUnselect.call(e,n.finder.getRow(e,i)))}}));for(var s,l,c,u=null,b=[],d=[],m=0;m<t.length;m++){var p=t[m],f=p,h=n.finder.getRow(e,p);if(h){f=h[n.textField],u=h;var x=n.finder.getEl(e,p);x.hasClass("combobox-item-selected")||(x.addClass("combobox-item-selected"),n.onSelect.call(e,h))}else s=p,l=n.mappingRows,c=void 0,f=((c=o.easyui.getArrayItem(l,n.valueField,s))?c[n.textField]:void 0)||p;b.push(p),d.push(f)}if(i||o(e).combo("setText",d.join(n.separator)),n.showItemIcon){var v=o(e).combobox("textbox");v.removeClass("textbox-bgicon "+n.textboxIconCls),u&&u.iconCls&&(v.addClass("textbox-bgicon "+u.iconCls),n.textboxIconCls=u.iconCls)}o(e).combo("setValues",b),a.triggerHandler("scroll")}function r(e,t,i){var n=o.data(e,"combobox"),r=n.options;n.data=r.loadFilter.call(e,t),r.view.render.call(r.view,e,o(e).combo("panel"),n.data);var s=o(e).combobox("getValues");o.easyui.forEach(n.data,!1,(function(e){e.selected&&o.easyui.addArrayItem(s,e[r.valueField]+"")})),r.multiple?a(e,s,i):a(e,s.length?[s[s.length-1]]:[],i),r.onLoadSuccess.call(e,t)}function s(e,t,i,n){var a=o.data(e,"combobox").options;t&&(a.url=t),i=o.extend({},a.queryParams,i||{}),0!=a.onBeforeLoad.call(e,i)&&a.loader.call(e,i,(function(o){r(e,o,n)}),(function(){a.onLoadError.apply(this,arguments)}))}o.fn.combobox=function(e,t){if("string"==typeof e){var i=o.fn.combobox.methods[e];return i?i(this,t):this.combo(e,t)}return e=e||{},this.each((function(){var t,i,n=o.data(this,"combobox");if(n?o.extend(n.options,e):n=o.data(this,"combobox",{options:o.extend({},o.fn.combobox.defaults,o.fn.combobox.parseOptions(this),e),data:[]}),t=this,i=o.data(t,"combobox").options,o(t).addClass("combobox-f"),o(t).combo(o.extend({},i,{onShowPanel:function(){o(this).combo("panel").find("div.combobox-item:hidden,div.combobox-group:hidden").show(),a(this,o(this).combobox("getValues"),!0),o(this).combobox("scrollTo",o(this).combobox("getValue")),i.onShowPanel.call(this)}})),n.options.data)r(this,n.options.data);else{var l=o.fn.combobox.parseData(this);l.length&&r(this,l)}s(this)}))},o.fn.combobox.methods={options:function(e){var t=e.combo("options");return o.extend(o.data(e[0],"combobox").options,{width:t.width,height:t.height,originalValue:t.originalValue,disabled:t.disabled,readonly:t.readonly,editable:t.editable})},cloneFrom:function(e,t){return e.each((function(){o(this).combo("cloneFrom",t),o.data(this,"combobox",o(t).data("combobox")),o(this).addClass("combobox-f").attr("comboboxName",o(this).attr("textboxName"))}))},getData:function(e){return o.data(e[0],"combobox").data},setValues:function(e,t){return e.each((function(){var e=o(this).combobox("options");o.isArray(t)&&(t=o.map(t,(function(t){return t&&"object"==typeof t?(o.easyui.addArrayItem(e.mappingRows,e.valueField,t),t[e.valueField]):t}))),a(this,t)}))},setValue:function(e,t){return e.each((function(){o(this).combobox("setValues",o.isArray(t)?t:[t])}))},clear:function(o){return o.each((function(){a(this,[])}))},reset:function(e){return e.each((function(){var e=o(this).combobox("options");e.multiple?o(this).combobox("setValues",e.originalValue):o(this).combobox("setValue",e.originalValue)}))},loadData:function(o,e){return o.each((function(){r(this,e)}))},reload:function(e,t){return e.each((function(){if("string"==typeof t)s(this,t);else{if(t)o(this).combobox("options").queryParams=t;s(this)}}))},select:function(o,e){return o.each((function(){i(this,e)}))},unselect:function(o,e){return o.each((function(){n(this,e)}))},scrollTo:function(e,t){return e.each((function(){!function(e,t){var i=o.data(e,"combobox").options,n=o(e).combo("panel"),a=i.finder.getEl(e,t);if(a.length)if(a.position().top<=0){var r=n.scrollTop()+a.position().top;n.scrollTop(r)}else a.position().top+a.outerHeight()>n.height()&&(r=n.scrollTop()+a.position().top+a.outerHeight()-n.height(),n.scrollTop(r));n.triggerHandler("scroll")}(this,t)}))}},o.fn.combobox.parseOptions=function(e){o(e);return o.extend({},o.fn.combo.parseOptions(e),o.parser.parseOptions(e,["valueField","textField","groupField","groupPosition","mode","method","url",{showItemIcon:"boolean",limitToList:"boolean"}]))},o.fn.combobox.parseData=function(e){var t=[],i=o(e).combobox("options");return o(e).children().each((function(){if("optgroup"==this.tagName.toLowerCase()){var e=o(this).attr("label");o(this).children().each((function(){n(this,e)}))}else n(this)})),t;function n(e,n){var a=o(e),r={};r[i.valueField]=null!=a.attr("value")?a.attr("value"):a.text(),r[i.textField]=a.text(),r.iconCls=o.parser.parseOptions(e,["iconCls"]).iconCls,r.selected=a.is(":selected"),r.disabled=a.is(":disabled"),n&&(i.groupField=i.groupField||"group",r[i.groupField]=n),t.push(r)}};var l=0,c={render:function(e,t,i){var n=o.data(e,"combobox"),a=n.options,r=o(e).attr("id")||"";l++,n.itemIdPrefix=r+"_easyui_combobox_i"+l,n.groupIdPrefix=r+"_easyui_combobox_g"+l,n.groups=[];for(var s=[],c=void 0,u=0;u<i.length;u++){var b=i[u],d=(b[a.valueField],b[a.textField]),m=b[a.groupField];m?c!=m?(c=m,n.groups.push({value:m,startIndex:u,count:1}),s.push('<div id="'+n.groupIdPrefix+"_"+(n.groups.length-1)+'" class="combobox-group">'),s.push(a.groupFormatter?a.groupFormatter.call(e,m):m),s.push("</div>")):n.groups[n.groups.length-1].count++:c=void 0;var p="combobox-item"+(b.disabled?" combobox-item-disabled":"")+(m?" combobox-gitem":"");s.push('<div id="'+n.itemIdPrefix+"_"+u+'" class="'+p+'">'),a.showItemIcon&&b.iconCls&&s.push('<span class="combobox-icon '+b.iconCls+'"></span>'),s.push(a.formatter?a.formatter.call(e,b):d),s.push("</div>")}o(t).html(s.join(""))}};o.fn.combobox.defaults=o.extend({},o.fn.combo.defaults,{valueField:"value",textField:"text",groupPosition:"static",groupField:null,groupFormatter:function(o){return o},mode:"local",method:"post",url:null,data:null,queryParams:{},showItemIcon:!1,limitToList:!1,unselectedValues:[],mappingRows:[],view:c,keyHandler:{up:function(o){t(this,"prev"),o.preventDefault()},down:function(o){t(this,"next"),o.preventDefault()},left:function(o){},right:function(o){},enter:function(t){!function(t){var i=o(t),n=i.combobox("options"),a=i.combobox("panel").children("div.combobox-item-hover");if(a.length){a.removeClass("combobox-item-hover");var r=n.finder.getRow(t,a)[n.valueField];n.multiple&&a.hasClass("combobox-item-selected")?i.combobox("unselect",r):i.combobox("select",r)}var s=[];o.map(i.combobox("getValues"),(function(o){e(t,o)>=0&&s.push(o)})),i.combobox("setValues",s),n.multiple||i.combobox("hidePanel")}(this)},query:function(e,t){!function(e,t){var n=o.data(e,"combobox"),r=n.options,l=o(),c=r.multiple?t.split(r.separator):[t];if("remote"==r.mode)m(c),s(e,null,{q:t},!0);else{var u=o(e).combo("panel");u.find(".combobox-item-hover").removeClass("combobox-item-hover"),u.find(".combobox-item,.combobox-group").hide();var b=n.data,d=[];o.map(c,(function(t){var n=t=o.trim(t),a=void 0;l=o();for(var s=0;s<b.length;s++){var c=b[s];if(r.filter.call(e,t,c)){var u=c[r.valueField],m=c[r.textField],p=c[r.groupField],f=r.finder.getEl(e,u).show();m.toLowerCase()==t.toLowerCase()&&(n=u,r.reversed?l=f:i(e,u,!0)),r.groupField&&a!=p&&(r.finder.getGroupEl(e,p).show(),a=p)}}d.push(n)})),m(d)}function m(o){r.reversed?l.addClass("combobox-item-hover"):a(e,r.multiple?t?o:[]:o,!0)}}(this,e)}},inputEvents:o.extend({},o.fn.combo.defaults.inputEvents,{blur:function(e){o.fn.combo.defaults.inputEvents.blur(e);var t=e.data.target,i=o(t).combobox("options");(i.reversed||i.limitToList)&&(i.blurTimer&&clearTimeout(i.blurTimer),i.blurTimer=setTimeout((function(){if(o(t).parent().length){if(i.reversed)o(t).combobox("setValues",o(t).combobox("getValues"));else if(i.limitToList){var e=[];o.map(o(t).combobox("getValues"),(function(n){o.easyui.indexOfArray(o(t).combobox("getData"),i.valueField,n)>=0&&e.push(n)})),o(t).combobox("setValues",e)}i.blurTimer=null}}),50))}}),panelEvents:{mouseover:function(e){o(this).children("div.combobox-item-hover").removeClass("combobox-item-hover");var t=o(e.target).closest("div.combobox-item");t.hasClass("combobox-item-disabled")||t.addClass("combobox-item-hover"),e.stopPropagation()},mouseout:function(e){o(e.target).closest("div.combobox-item").removeClass("combobox-item-hover"),e.stopPropagation()},mousedown:function(o){o.preventDefault(),o.stopPropagation()},click:function(e){var t=o(this).panel("options").comboTarget;if(t){var a=o(t).combobox("options"),r=o(e.target).closest("div.combobox-item");if(r.length&&!r.hasClass("combobox-item-disabled")){var s=a.finder.getRow(t,r);if(s){a.blurTimer&&(clearTimeout(a.blurTimer),a.blurTimer=null),a.onClick.call(t,s);var l=s[a.valueField];a.multiple?r.hasClass("combobox-item-selected")?n(t,l):i(t,l):o(t).combobox("setValue",l).combobox("hidePanel"),e.stopPropagation()}}}},scroll:function(e){var t=o(this).panel("options").comboTarget;if(t){var i=o(t).combobox("options");if("sticky"==i.groupPosition){var n=o(this).children(".combobox-stick");n.length||(n=o('<div class="combobox-stick"></div>').appendTo(this)),n.hide();var a=o(t).data("combobox");o(this).children(".combobox-group:visible").each((function(){var e=o(this),r=i.finder.getGroup(t,e),s=a.data[r.startIndex+r.count-1],l=i.finder.getEl(t,s[i.valueField]);if(e.position().top<0&&l.position().top>0)return n.show().html(e.html()),!1}))}}}},filter:function(e,t){return t[o(this).combobox("options").textField].toLowerCase().indexOf(e.toLowerCase())>=0},formatter:function(e){return e[o(this).combobox("options").textField]},loader:function(e,t,i){var n=o(this).combobox("options");if(!n.url)return!1;o.ajax({type:n.method,url:n.url,data:e,dataType:"json",success:function(o){t(o)},error:function(){i.apply(this,arguments)}})},loadFilter:function(o){return o},finder:{getEl:function(t,i){var n=e(t,i),a=o.data(t,"combobox").itemIdPrefix+"_"+n;return o("#"+a)},getGroupEl:function(e,t){var i=o.data(e,"combobox"),n=o.easyui.indexOfArray(i.groups,"value",t),a=i.groupIdPrefix+"_"+n;return o("#"+a)},getGroup:function(e,t){var i=o.data(e,"combobox"),n=t.attr("id").substr(i.groupIdPrefix.length+1);return i.groups[parseInt(n)]},getRow:function(t,i){var n=o.data(t,"combobox"),a=i instanceof o?i.attr("id").substr(n.itemIdPrefix.length+1):e(t,i);return n.data[parseInt(a)]}},onBeforeLoad:function(o){},onLoadSuccess:function(o){},onLoadError:function(){},onSelect:function(o){},onUnselect:function(o){},onClick:function(o){}})}(jQuery);