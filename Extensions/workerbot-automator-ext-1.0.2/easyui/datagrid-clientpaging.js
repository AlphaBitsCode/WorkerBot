/* Copyright (C) 2023 by WorkerBot.AI */
!function(a){function t(t){a.isArray(t)&&(t={total:t.length,rows:t});var r=this,e=a(r),o=e.data("datagrid"),i=e.datagrid("options");if(o.allRows||(o.allRows=t.rows),!i.remoteSort&&i.sortName){var n=i.sortName.split(","),d=i.sortOrder.split(",");o.allRows.sort((function(t,e){for(var o=0,i=0;i<n.length;i++){var l=n[i],s=d[i];if(0!=(o=(a(r).datagrid("getColumnOption",l).sorter||function(a,t){return a==t?0:a>t?1:-1})(t[l],e[l])*("asc"==s?1:-1)))return o}return o}))}var l=(i.pageNumber-1)*parseInt(i.pageSize),s=l+parseInt(i.pageSize);return t.rows=o.allRows.slice(l,s),t}var r=a.fn.datagrid.methods.loadData,e=a.fn.datagrid.methods.deleteRow;a.extend(a.fn.datagrid.methods,{clientPaging:function(r){return r.each((function(){var r=a(this),e=r.data("datagrid"),o=e.options;o.loadFilter=t;var i=o.onBeforeLoad;o.onBeforeLoad=function(a){return e.allRows=null,i.call(this,a)};var n=r.datagrid("getPager");n.pagination({onSelectPage:function(a,t){o.pageNumber=a,o.pageSize=t,n.pagination("refresh",{pageNumber:a,pageSize:t}),r.datagrid("loadData",e.allRows)}}),a(this).datagrid("loadData",e.data),o.url&&a(this).datagrid("reload")}))},loadData:function(t,e){return t.each((function(){a(this).data("datagrid").allRows=null})),r.call(a.fn.datagrid.methods,t,e)},deleteRow:function(r,o){return r.each((function(){var r=a(this).datagrid("getRows")[o];e.call(a.fn.datagrid.methods,a(this),o);var i=a(this).data("datagrid");if(i.options.loadFilter==t){for(var n=0;n<i.allRows.length;n++)if(i.allRows[n]==r){i.allRows.splice(n,1);break}a(this).datagrid("loadData",i.allRows)}}))},getAllRows:function(a){return a.data("datagrid").allRows}})}(jQuery);