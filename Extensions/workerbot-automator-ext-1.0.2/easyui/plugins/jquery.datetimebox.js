/* Copyright (C) 2023 by WorkerBot.AI */
!function(t){function e(e){var a,o,i,r,s=t.data(e,"datetimebox").options,d=(o=t(a=e).datetimebox("calendar"),i=t(a).datetimebox("spinner"),r=o.calendar("options").current,new Date(r.getFullYear(),r.getMonth(),r.getDate(),i.timespinner("getHours"),i.timespinner("getMinutes"),i.timespinner("getSeconds")));n(e,s.formatter.call(e,d)),t(e).combo("hidePanel")}function n(e,n,a){var o=t.data(e,"datetimebox").options;if(t(e).combo("setValue",n),!a)if(n){var i=o.parser.call(e,n);t(e).combo("setText",o.formatter.call(e,i)),t(e).combo("setValue",o.formatter.call(e,i))}else t(e).combo("setText",n);i=o.parser.call(e,n);t(e).datetimebox("calendar").calendar("moveTo",i),t(e).datetimebox("spinner").timespinner("setValue",function(n){function a(t){return(t<10?"0":"")+t}var i=[a(n.getHours()),a(n.getMinutes())];o.showSeconds&&i.push(a(n.getSeconds()));return i.join(t(e).datetimebox("spinner").timespinner("options").separator)}(i))}t.fn.datetimebox=function(e,a){if("string"==typeof e){var o=t.fn.datetimebox.methods[e];return o?o(this,a):this.datebox(e,a)}return e=e||{},this.each((function(){var a=t.data(this,"datetimebox");a?t.extend(a.options,e):t.data(this,"datetimebox",{options:t.extend({},t.fn.datetimebox.defaults,t.fn.datetimebox.parseOptions(this),e)}),function(e){var a=t.data(e,"datetimebox"),o=a.options;if(t(e).datebox(t.extend({},o,{onShowPanel:function(){n(this,t(this).datetimebox("getValue"),!0),o.onShowPanel.call(this)},formatter:t.fn.datebox.defaults.formatter,parser:t.fn.datebox.defaults.parser})),t(e).removeClass("datebox-f").addClass("datetimebox-f"),t(e).datebox("calendar").calendar({onSelect:function(t){o.onSelect.call(this.target,t)}}),!a.spinner){var i=t(e).datebox("panel"),r=t('<div style="padding:2px"><input></div>').insertAfter(i.children("div.datebox-calendar-inner"));a.spinner=r.children("input")}a.spinner.timespinner({width:o.spinnerWidth,showSeconds:o.showSeconds,separator:o.timeSeparator,hour12:o.hour12}),t(e).datetimebox("initValue",o.value)}(this)}))},t.fn.datetimebox.methods={options:function(e){var n=e.datebox("options");return t.extend(t.data(e[0],"datetimebox").options,{originalValue:n.originalValue,disabled:n.disabled,readonly:n.readonly})},cloneFrom:function(e,n){return e.each((function(){t(this).datebox("cloneFrom",n),t.data(this,"datetimebox",{options:t.extend(!0,{},t(n).datetimebox("options")),spinner:t(n).datetimebox("spinner")}),t(this).removeClass("datebox-f").addClass("datetimebox-f")}))},spinner:function(e){return t.data(e[0],"datetimebox").spinner},initValue:function(e,n){return e.each((function(){var e=t(this).datetimebox("options"),n=e.value;if(n){var a=e.parser.call(this,n);n=e.formatter.call(this,a),t(this).datetimebox("calendar").calendar("moveTo",a)}t(this).combo("initValue",n).combo("setText",n)}))},setValue:function(t,e){return t.each((function(){n(this,e)}))},reset:function(e){return e.each((function(){var e=t(this).datetimebox("options");t(this).datetimebox("setValue",e.originalValue)}))},setDate:function(e,a){return e.each((function(){var e=t(this).datetimebox("options");t(this).datetimebox("calendar").calendar("moveTo",a),n(this,a?e.formatter.call(this,a):"")}))},getDate:function(t){return t.datetimebox("getValue")?t.datetimebox("calendar").calendar("options").current:null}},t.fn.datetimebox.parseOptions=function(e){t(e);return t.extend({},t.fn.datebox.parseOptions(e),t.parser.parseOptions(e,["timeSeparator","spinnerWidth",{showSeconds:"boolean"}]))},t.fn.datetimebox.defaults=t.extend({},t.fn.datebox.defaults,{spinnerWidth:"100%",showSeconds:!0,timeSeparator:":",hour12:!1,panelEvents:{mousedown:function(t){}},keyHandler:{up:function(t){},down:function(t){},left:function(t){},right:function(t){},enter:function(t){e(this)},query:function(t,e){!function(t,e){n(t,e,!0)}(this,t)}},buttons:[{text:function(e){return t(e).datetimebox("options").currentText},handler:function(e){n(e,t(e).datetimebox("options").formatter.call(e,new Date)),t(e).datetimebox("hidePanel")}},{text:function(e){return t(e).datetimebox("options").okText},handler:function(t){e(t)}},{text:function(e){return t(e).datetimebox("options").closeText},handler:function(e){t(e).datetimebox("hidePanel")}}],formatter:function(e){return e?t.fn.datebox.defaults.formatter.call(this,e)+" "+t.fn.timespinner.defaults.formatter.call(t(this).datetimebox("spinner")[0],e):""},parser:function(e){if(!(e=t.trim(e)))return new Date;var n=e.split(" "),a=t.fn.datebox.defaults.parser.call(this,n[0]);if(n.length<2)return a;var o=t.fn.timespinner.defaults.parser.call(t(this).datetimebox("spinner")[0],n[1]+(n[2]?" "+n[2]:""));return new Date(a.getFullYear(),a.getMonth(),a.getDate(),o.getHours(),o.getMinutes(),o.getSeconds())}})}(jQuery);