/* Copyright (C) 2023 by WorkerBot.AI */
!function(e){function t(t,r){var n=e.data(t,"datagrid").options;if(!e.data(t,"datagrid").dc.body1.is(":empty")&&(!n.nowrap||n.autoRowHeight)&&null!=r)for(var i=g(t,r),a=0;a<i.length;a++)d(i[a][n.idField]);function d(e){var r=n.finder.getTr(t,e,"body",1),i=n.finder.getTr(t,e,"body",2);r.css("height",""),i.css("height","");var a=Math.max(r.height(),i.height());r.css("height",a),i.css("height",a)}e(t).datagrid("fixRowHeight",r)}function r(t){var r=e.data(t,"datagrid").dc;e.data(t,"treegrid").options.rownumbers&&r.body1.find("div.datagrid-cell-rownumber").each((function(t){e(this).html(t+1)}))}function n(t){return function(r){e.fn.datagrid.defaults.rowEvents[t?"mouseover":"mouseout"](r);var n=e(r.target),i=t?"addClass":"removeClass";n.hasClass("tree-hit")&&(n.hasClass("tree-expanded")?n[i]("tree-expanded-hover"):n[i]("tree-collapsed-hover"))}}function i(t,r,n,i){var o=e.data(t,"treegrid"),l=(o.checkedRows,o.options);if(l.checkbox){var c=p(t,r);if(c.checkState){var s=l.finder.getTr(t,r).find(".tree-checkbox");if(null==n&&(s.hasClass("tree-checkbox1")?n=!1:s.hasClass("tree-checkbox0")?n=!0:(null==c._checked&&(c._checked=s.hasClass("tree-checkbox1")),n=!c._checked)),c._checked=n,n){if(s.hasClass("tree-checkbox1"))return}else if(s.hasClass("tree-checkbox0"))return;(i||0!=l.onBeforeCheckNode.call(t,c,n))&&(l.cascadeCheck?(!function(t,r,n){var i=n?1:0;a(t,r,i),e.easyui.forEach(r.children||[],!0,(function(e){a(t,e,i)}))}(t,c,n),d(t,c)):a(t,c,n?"1":"0"),i||l.onCheckNode.call(t,c,n))}}}function a(t,r,n){var i=e.data(t,"treegrid"),a=i.checkedRows,d=i.options;if(r.checkState&&null!=n){var o=d.finder.getTr(t,r[d.idField]).find(".tree-checkbox");o.length&&(r.checkState=["unchecked","checked","indeterminate"][n],r.checked="checked"==r.checkState,o.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2"),o.addClass("tree-checkbox"+n),0==n?e.easyui.removeArrayItem(a,d.idField,r[d.idField]):e.easyui.addArrayItem(a,d.idField,r))}}function d(t,r){var n=u(t,r[e.data(t,"treegrid").options.idField]);n&&(a(t,n,o(n)),d(t,n))}function o(t){var r=0,n=0,i=0;if(e.easyui.forEach(t.children||[],!1,(function(e){e.checkState&&(r++,"checked"==e.checkState?i++:"unchecked"==e.checkState&&n++)})),0!=r){return n==r?0:i==r?1:2}}function l(t,r){var n=e.data(t,"treegrid").options;if(n.checkbox){var a=p(t,r),l=n.finder.getTr(t,r),c=l.find(".tree-checkbox");if(n.view.hasCheckbox(t,a))if(c.length||(a.checkState=a.checkState||"unchecked",e('<span class="tree-checkbox"></span>').insertBefore(l.find(".tree-title"))),"checked"==a.checkState)i(t,r,!0,!0);else if("unchecked"==a.checkState)i(t,r,!1,!0);else{var s=o(a);0===s?i(t,r,!1,!0):1===s&&i(t,r,!0,!0)}else c.remove(),a.checkState=void 0,a.checked=void 0,d(t,a)}}function c(t,r){var n=e.data(t,"treegrid").options,i=n.finder.getTr(t,r,"body",1),a=n.finder.getTr(t,r,"body",2),d=e(t).datagrid("getColumnFields",!0).length+(n.rownumbers?1:0),o=e(t).datagrid("getColumnFields",!1).length;function l(t,r){e('<tr class="treegrid-tr-tree"><td style="border:0px" colspan="'+r+'"><div></div></td></tr>').insertAfter(t)}l(i,d),l(a,o)}function s(n,i,a,d,o){var l=e.data(n,"treegrid"),c=l.options,s=l.dc;a=c.loadFilter.call(n,a,i);var f=p(n,i);if(f){var u=c.finder.getTr(n,i,"body",1),g=c.finder.getTr(n,i,"body",2),v=u.next("tr.treegrid-tr-tree").children("td").children("div"),m=g.next("tr.treegrid-tr-tree").children("td").children("div");d||(f.children=[])}else{v=s.body1,m=s.body2;d||(l.data=[])}if(d||(v.empty(),m.empty()),c.view.onBeforeRender&&c.view.onBeforeRender.call(c.view,n,i,a),c.view.render.call(c.view,n,v,!0),c.view.render.call(c.view,n,m,!1),c.showFooter&&(c.view.renderFooter.call(c.view,n,s.footer1,!0),c.view.renderFooter.call(c.view,n,s.footer2,!1)),c.view.onAfterRender&&c.view.onAfterRender.call(c.view,n),!i&&c.pagination){e.data(n,"treegrid").total;var k=e(n).datagrid("getPager"),b=k.pagination("options");b.total!=a.total&&(k.pagination("refresh",{pageNumber:c.pageNumber,total:a.total}),c.pageNumber!=b.pageNumber&&b.pageNumber>0&&(c.pageNumber=b.pageNumber,h(n)))}t(n),r(n),e(n).treegrid("showLines"),e(n).treegrid("setSelectionState"),e(n).treegrid("autoSizeColumn"),o||c.onLoadSuccess.call(n,f,a)}function h(t,r,n,i,a){var d=e.data(t,"treegrid").options,o=e(t).datagrid("getPanel").find("div.datagrid-body");null==r&&d.queryParams&&(d.queryParams.id=void 0),n&&(d.queryParams=n);var l=e.extend({},d.queryParams);d.pagination&&e.extend(l,{page:d.pageNumber,rows:d.pageSize}),d.sortName&&e.extend(l,{sort:d.sortName,order:d.sortOrder});var c=p(t,r);if(0!=d.onBeforeLoad.call(t,c,l)){var h=o.find('tr[node-id="'+r+'"] span.tree-folder');h.addClass("tree-loading"),e(t).treegrid("loading");var f=d.loader.call(t,l,(function(n){h.removeClass("tree-loading"),e(t).treegrid("loaded"),s(t,r,n,i),a&&a()}),(function(){h.removeClass("tree-loading"),e(t).treegrid("loaded"),d.onLoadError.apply(t,arguments),a&&a()}));0==f&&(h.removeClass("tree-loading"),e(t).treegrid("loaded"))}}function f(t){return e.data(t,"treegrid").data}function u(e,t){var r=p(e,t);return r._parentId?p(e,r._parentId):null}function g(t,r){var n=e.data(t,"treegrid").data;if(r){var i=p(t,r);n=i&&i.children||[]}var a=[];return e.easyui.forEach(n,!0,(function(e){a.push(e)})),a}function p(t,r){var n=e.data(t,"treegrid"),i=n.options,a=null;return e.easyui.forEach(n.data,!0,(function(e){if(e[i.idField]==r)return a=e,!1})),a}function v(r,n){var i=e.data(r,"treegrid").options,a=p(r,n),d=i.finder.getTr(r,n),o=d.find("span.tree-hit");if(0!=o.length&&!o.hasClass("tree-collapsed")&&0!=i.onBeforeCollapse.call(r,a)){o.removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed"),o.next().removeClass("tree-folder-open"),a.state="closed";var l=(d=d.next("tr.treegrid-tr-tree")).children("td").children("div");i.animate?l.slideUp("normal",(function(){e(r).treegrid("autoSizeColumn"),t(r,n),i.onCollapse.call(r,a)})):(l.hide(),e(r).treegrid("autoSizeColumn"),t(r,n),i.onCollapse.call(r,a))}}function m(r,n){var i=e.data(r,"treegrid").options,a=i.finder.getTr(r,n),d=a.find("span.tree-hit"),o=p(r,n);if(0!=d.length&&(!d.hasClass("tree-expanded")&&0!=i.onBeforeExpand.call(r,o)))if(d.removeClass("tree-collapsed tree-collapsed-hover").addClass("tree-expanded"),d.next().addClass("tree-folder-open"),(s=a.next("tr.treegrid-tr-tree")).length){u(l=s.children("td").children("div"))}else{c(r,o[i.idField]);var l,s=a.next("tr.treegrid-tr-tree");(l=s.children("td").children("div")).hide();var f=e.extend({},i.queryParams||{});f.id=o[i.idField],h(r,o[i.idField],f,!0,(function(){l.is(":empty")?s.remove():u(l)}))}function u(a){o.state="open",i.animate?a.slideDown("normal",(function(){e(r).treegrid("autoSizeColumn"),t(r,n),i.onExpand.call(r,o)})):(a.show(),e(r).treegrid("autoSizeColumn"),t(r,n),i.onExpand.call(r,o))}}function k(t,r){e.data(t,"treegrid").options.finder.getTr(t,r).find("span.tree-hit").hasClass("tree-expanded")?v(t,r):m(t,r)}function b(t,r){var n=e.data(t,"treegrid"),i=n.options;if(r.parent){var a=i.finder.getTr(t,r.parent);0==a.next("tr.treegrid-tr-tree").length&&c(t,r.parent);var d=a.children('td[field="'+i.treeField+'"]').children("div.datagrid-cell").children("span.tree-icon");if(d.hasClass("tree-file")){d.removeClass("tree-file").addClass("tree-folder tree-folder-open");var o=e('<span class="tree-hit tree-expanded"></span>').insertBefore(d);o.prev().length&&o.prev().remove()}}s(t,r.parent,r.data,n.data.length>0,!0)}e.fn.treegrid=function(r,n){if("string"==typeof r){var i=e.fn.treegrid.methods[r];return i?i(this,n):this.datagrid(r,n)}return r=r||{},this.each((function(){var n=e.data(this,"treegrid");n?e.extend(n.options,r):n=e.data(this,"treegrid",{options:e.extend({},e.fn.treegrid.defaults,e.fn.treegrid.parseOptions(this),r),data:[],checkedRows:[],tmpIds:[]}),function(r){var n=e.data(r,"treegrid"),i=n.options;e(r).datagrid(e.extend({},i,{url:null,data:null,loader:function(){return!1},onBeforeLoad:function(){return!1},onLoadSuccess:function(){},onResizeColumn:function(e,n){t(r),i.onResizeColumn.call(r,e,n)},onBeforeSortColumn:function(e,t){if(0==i.onBeforeSortColumn.call(r,e,t))return!1},onSortColumn:function(t,n){if(i.sortName=t,i.sortOrder=n,i.remoteSort)h(r);else{var a=e(r).treegrid("getData");s(r,null,a)}i.onSortColumn.call(r,t,n)},onClickCell:function(e,t){i.onClickCell.call(r,t,p(r,e))},onDblClickCell:function(e,t){i.onDblClickCell.call(r,t,p(r,e))},onRowContextMenu:function(e,t){i.onContextMenu.call(r,e,p(r,t))}}));var a=e.data(r,"datagrid").options;if(i.columns=a.columns,i.frozenColumns=a.frozenColumns,n.dc=e.data(r,"datagrid").dc,i.pagination){var d=e(r).datagrid("getPager");d.pagination({total:0,pageNumber:i.pageNumber,pageSize:i.pageSize,pageList:i.pageList,onSelectPage:function(e,t){i.pageNumber=e||1,i.pageSize=t,d.pagination("refresh",{pageNumber:e,pageSize:t}),h(r)}}),i.pageSize=d.pagination("options").pageSize}}(this),n.options.data&&e(this).treegrid("loadData",n.options.data),h(this)}))},e.fn.treegrid.methods={options:function(t){return e.data(t[0],"treegrid").options},resize:function(t,r){return t.each((function(){e(this).datagrid("resize",r)}))},fixRowHeight:function(e,r){return e.each((function(){t(this,r)}))},loadData:function(e,t){return e.each((function(){s(this,t.parent,t)}))},load:function(t,r){return t.each((function(){e(this).treegrid("options").pageNumber=1,e(this).treegrid("getPager").pagination({pageNumber:1}),e(this).treegrid("reload",r)}))},reload:function(t,r){return t.each((function(){var t=e(this).treegrid("options"),n={};if("object"==typeof r?n=r:(n=e.extend({},t.queryParams)).id=r,n.id){var i=e(this).treegrid("find",n.id);i.children&&i.children.splice(0,i.children.length),t.queryParams=n;var a=t.finder.getTr(this,n.id);a.next("tr.treegrid-tr-tree").remove(),a.find("span.tree-hit").removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed"),m(this,n.id)}else h(this,null,n)}))},reloadFooter:function(t,r){return t.each((function(){var t=e.data(this,"treegrid").options,n=e.data(this,"datagrid").dc;r&&(e.data(this,"treegrid").footer=r),t.showFooter&&(t.view.renderFooter.call(t.view,this,n.footer1,!0),t.view.renderFooter.call(t.view,this,n.footer2,!1),t.view.onAfterRender&&t.view.onAfterRender.call(t.view,this),e(this).treegrid("fixRowHeight"))}))},getData:function(t){return e.data(t[0],"treegrid").data},getFooterRows:function(t){return e.data(t[0],"treegrid").footer},getRoot:function(e){return t=e[0],(r=f(t)).length?r[0]:null;var t,r},getRoots:function(e){return f(e[0])},getParent:function(e,t){return u(e[0],t)},getChildren:function(e,t){return g(e[0],t)},getLevel:function(t,r){return n=t[0],i=r,(a=e.data(n,"treegrid").options).finder.getTr(n,i).children('td[field="'+a.treeField+'"]').find("span.tree-indent,span.tree-hit").length;var n,i,a},find:function(e,t){return p(e[0],t)},isLeaf:function(t,r){return 0==e.data(t[0],"treegrid").options.finder.getTr(t[0],r).find("span.tree-hit").length},select:function(t,r){return t.each((function(){e(this).datagrid("selectRow",r)}))},unselect:function(t,r){return t.each((function(){e(this).datagrid("unselectRow",r)}))},collapse:function(e,t){return e.each((function(){v(this,t)}))},expand:function(e,t){return e.each((function(){m(this,t)}))},toggle:function(e,t){return e.each((function(){k(this,t)}))},collapseAll:function(t,r){return t.each((function(){!function(t,r){var n=e.data(t,"treegrid").options,i=g(t,r);r&&i.unshift(p(t,r));for(var a=0;a<i.length;a++)v(t,i[a][n.idField])}(this,r)}))},expandAll:function(t,r){return t.each((function(){!function(t,r){var n=e.data(t,"treegrid").options,i=g(t,r);r&&i.unshift(p(t,r));for(var a=0;a<i.length;a++)m(t,i[a][n.idField])}(this,r)}))},expandTo:function(t,r){return t.each((function(){!function(t,r){for(var n=e.data(t,"treegrid").options,i=[],a=u(t,r);a;){var d=a[n.idField];i.unshift(d),a=u(t,d)}for(var o=0;o<i.length;o++)m(t,i[o])}(this,r)}))},append:function(e,t){return e.each((function(){b(this,t)}))},insert:function(t,n){return t.each((function(){!function(t,n){var i=n.before||n.after,a=e.data(t,"treegrid").options,d=u(t,i);b(t,{parent:d?d[a.idField]:null,data:[n.data]});for(var o=d?d.children:e(t).treegrid("getRoots"),l=0;l<o.length;l++)if(o[l][a.idField]==i){var c=o[o.length-1];o.splice(n.before?l:l+1,0,c),o.splice(o.length-1,1);break}function s(e){var r=e?1:2,d=a.finder.getTr(t,n.data[a.idField],"body",r),o=d.closest("table.datagrid-btable");d=d.parent().children();var l=a.finder.getTr(t,i,"body",r);if(n.before)d.insertBefore(l);else{var c=l.next("tr.treegrid-tr-tree");d.insertAfter(c.length?c:l)}o.remove()}s(!0),s(!1),r(t),e(t).treegrid("showLines")}(this,n)}))},remove:function(t,n){return t.each((function(){var t,i,a,d,o;t=this,i=n,a=e.data(t,"treegrid"),d=a.options,o=u(t,i),e(t).datagrid("deleteRow",i),e.easyui.removeArrayItem(a.checkedRows,d.idField,i),r(t),o&&l(t,o[d.idField]),a.total-=1,e(t).datagrid("getPager").pagination("refresh",{total:a.total}),e(t).treegrid("showLines")}))},pop:function(e,t){var r=e.treegrid("find",t);return e.treegrid("remove",t),r},refresh:function(t,r){return t.each((function(){var t=e.data(this,"treegrid").options;t.view.refreshRow.call(t.view,this,r)}))},update:function(t,r){return t.each((function(){var t=e.data(this,"treegrid").options,n=r.row;t.view.updateRow.call(t.view,this,r.id,n),null!=n.checked&&(n=p(this,r.id),e.extend(n,{checkState:n.checked?"checked":!1===n.checked?"unchecked":void 0}),l(this,r.id))}))},beginEdit:function(t,r){return t.each((function(){e(this).datagrid("beginEdit",r),e(this).treegrid("fixRowHeight",r)}))},endEdit:function(t,r){return t.each((function(){e(this).datagrid("endEdit",r)}))},cancelEdit:function(t,r){return t.each((function(){e(this).datagrid("cancelEdit",r)}))},showLines:function(t){return t.each((function(){!function(t){var r=e(t),n=r.treegrid("options");if(n.lines){r.treegrid("getPanel").addClass("tree-lines"),r.treegrid("getPanel").find("span.tree-indent").removeClass("tree-line tree-join tree-joinbottom"),r.treegrid("getPanel").find("div.datagrid-cell").removeClass("tree-node-last tree-root-first tree-root-one");var i=r.treegrid("getRoots");i.length>1?a(i[0]).addClass("tree-root-first"):1==i.length&&a(i[0]).addClass("tree-root-one"),function t(r){if(e.map(r,(function(e){e.children&&e.children.length?t(e.children):a(e).find(".tree-icon").prev().addClass("tree-join")})),r.length){var n=a(r[r.length-1]);n.addClass("tree-node-last"),n.find(".tree-join").removeClass("tree-join").addClass("tree-joinbottom")}}(i),function i(a){e.map(a,(function(e){e.children&&e.children.length&&i(e.children)}));for(var d=0;d<a.length-1;d++){var o=a[d],l=r.treegrid("getLevel",o[n.idField]);n.finder.getTr(t,o[n.idField]).next().find('tr.datagrid-row td[field="'+n.treeField+'"] div.datagrid-cell').find("span:eq("+(l-1)+")").addClass("tree-line")}}(i)}else r.treegrid("getPanel").removeClass("tree-lines");function a(e){return n.finder.getTr(t,e[n.idField]).find('td[field="'+n.treeField+'"] div.datagrid-cell')}}(this)}))},setSelectionState:function(t){return t.each((function(){e(this).datagrid("setSelectionState");for(var t=e(this).data("treegrid"),r=0;r<t.tmpIds.length;r++)i(this,t.tmpIds[r],!0,!0);t.tmpIds=[]}))},getCheckedNodes:function(t,r){r=r||"checked";var n=[];return e.easyui.forEach(t.data("treegrid").checkedRows,!1,(function(e){e.checkState==r&&n.push(e)})),n},checkNode:function(e,t){return e.each((function(){i(this,t,!0)}))},uncheckNode:function(e,t){return e.each((function(){i(this,t,!1)}))},clearChecked:function(t){return t.each((function(){var t=this,r=e(t).treegrid("options");e(t).datagrid("clearChecked"),e.map(e(t).treegrid("getCheckedNodes"),(function(e){i(t,e[r.idField],!1,!0)}))}))}},e.fn.treegrid.parseOptions=function(t){return e.extend({},e.fn.datagrid.parseOptions(t),e.parser.parseOptions(t,["treeField",{checkbox:"boolean",cascadeCheck:"boolean",onlyLeafCheck:"boolean"},{animate:"boolean"}]))};var C=e.extend({},e.fn.datagrid.defaults.view,{render:function(t,r,n){var i=e.data(t,"treegrid").options,a=e(t).datagrid("getColumnFields",n),d=e.data(t,"datagrid").rowIdPrefix;if(!n||i.rownumbers||i.frozenColumns&&i.frozenColumns.length){var o=this;if(this.treeNodes&&this.treeNodes.length){var l=function r(n,l,c){for(var s=e(t).treegrid("getParent",c[0][i.idField]),h=(s?s.children.length:e(t).treegrid("getRoots").length)-c.length,f=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'],u=0;u<c.length;u++){var g=c[u];"open"!=g.state&&"closed"!=g.state&&(g.state="open");var p=i.rowStyler?i.rowStyler.call(t,g):"",v=this.getStyleValue(p),m='class="datagrid-row '+(h++%2&&i.striped?"datagrid-row-alt ":" ")+v.c+'"',k=v.s?'style="'+v.s+'"':"",b=d+"-"+(n?1:2)+"-"+g[i.idField];if(f.push('<tr id="'+b+'" node-id="'+g[i.idField]+'" '+m+" "+k+">"),(f=f.concat(o.renderRow.call(o,t,a,n,l,g))).push("</tr>"),g.children&&g.children.length){var C=r.call(this,n,l+1,g.children),w="closed"==g.state?"none":"block";f.push('<tr class="treegrid-tr-tree"><td style="border:0px" colspan='+(a.length+(i.rownumbers?1:0))+'><div style="display:'+w+'">'),(f=f.concat(C)).push("</div></td></tr>")}}return f.push("</tbody></table>"),f}.call(this,n,this.treeLevel,this.treeNodes);e(r).append(l.join(""))}}},renderFooter:function(t,r,n){for(var i=e.data(t,"treegrid").options,a=e.data(t,"treegrid").footer||[],d=e(t).datagrid("getColumnFields",n),o=['<table class="datagrid-ftable" cellspacing="0" cellpadding="0" border="0"><tbody>'],l=0;l<a.length;l++){var c=a[l];c[i.idField]=c[i.idField]||"foot-row-id"+l,o.push('<tr class="datagrid-row" node-id="'+c[i.idField]+'">'),o.push(this.renderRow.call(this,t,d,n,0,c)),o.push("</tr>")}o.push("</tbody></table>"),e(r).html(o.join(""))},renderRow:function(t,r,n,i,a){var d=e.data(t,"treegrid"),o=d.options,l=[];n&&o.rownumbers&&l.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">0</div></td>');for(var c=0;c<r.length;c++){var s=r[c],h=e(t).datagrid("getColumnOption",s);if(h){var f=h.styler&&h.styler(a[s],a)||"",u=this.getStyleValue(f),g=u.c?'class="'+u.c+'"':"",p=h.hidden?'style="display:none;'+u.s+'"':u.s?'style="'+u.s+'"':"";l.push('<td field="'+s+'" '+g+" "+p+">");p="";if(h.checkbox||(h.align&&(p+="text-align:"+h.align+";"),o.nowrap?o.autoRowHeight&&(p+="height:auto;"):p+="white-space:normal;height:auto;"),l.push('<div style="'+p+'" '),h.checkbox?l.push('class="datagrid-cell-check '):l.push('class="datagrid-cell '+h.cellClass),s==o.treeField&&l.push(" tree-node"),l.push('">'),h.checkbox)a.checked?l.push('<input type="checkbox" checked="checked"'):l.push('<input type="checkbox"'),l.push(' name="'+s+'" value="'+(null!=a[s]?a[s]:"")+'">');else{var v=null;if(v=h.formatter?h.formatter(a[s],a):a[s],s==o.treeField){for(var m=0;m<i;m++)l.push('<span class="tree-indent"></span>');if("closed"==a.state?(l.push('<span class="tree-hit tree-collapsed"></span>'),l.push('<span class="tree-icon tree-folder '+(a.iconCls?a.iconCls:"")+'"></span>')):a.children&&a.children.length?(l.push('<span class="tree-hit tree-expanded"></span>'),l.push('<span class="tree-icon tree-folder tree-folder-open '+(a.iconCls?a.iconCls:"")+'"></span>')):(l.push('<span class="tree-indent"></span>'),l.push('<span class="tree-icon tree-file '+(a.iconCls?a.iconCls:"")+'"></span>')),this.hasCheckbox(t,a)){var k=0,b=e.easyui.getArrayItem(d.checkedRows,o.idField,a[o.idField]);if(b)k="checked"==b.checkState?1:2,a.checkState=b.checkState,a.checked=b.checked,e.easyui.addArrayItem(d.checkedRows,o.idField,a);else{var C=e.easyui.getArrayItem(d.checkedRows,o.idField,a._parentId);C&&"checked"==C.checkState&&o.cascadeCheck?(k=1,a.checked=!0,e.easyui.addArrayItem(d.checkedRows,o.idField,a)):a.checked&&e.easyui.addArrayItem(d.tmpIds,a[o.idField]),a.checkState=k?"checked":"unchecked"}l.push('<span class="tree-checkbox tree-checkbox'+k+'"></span>')}else a.checkState=void 0,a.checked=void 0;l.push('<span class="tree-title">'+v+"</span>")}else l.push(v)}l.push("</div>"),l.push("</td>")}}return l.join("")},hasCheckbox:function(t,r){var n=e.data(t,"treegrid").options;if(n.checkbox){if(e.isFunction(n.checkbox))return!!n.checkbox.call(t,r);if(!n.onlyLeafCheck)return!0;if(!("open"!=r.state||r.children&&r.children.length))return!0}return!1},refreshRow:function(e,t){this.updateRow.call(this,e,t,{})},updateRow:function(t,r,n){var i=e.data(t,"treegrid").options,a=e(t).treegrid("find",r);e.extend(a,n);var d=e(t).treegrid("getLevel",r)-1,o=i.rowStyler?i.rowStyler.call(t,a):"",l=e.data(t,"datagrid").rowIdPrefix,c=a[i.idField];function s(n){var s=e(t).treegrid("getColumnFields",n),h=i.finder.getTr(t,r,"body",n?1:2),f=h.find("div.datagrid-cell-rownumber").html(),u=h.find("div.datagrid-cell-check input[type=checkbox]").is(":checked");h.html(this.renderRow(t,s,n,d,a)),h.attr("style",o||""),h.find("div.datagrid-cell-rownumber").html(f),u&&h.find("div.datagrid-cell-check input[type=checkbox]")._propAttr("checked",!0),c!=r&&(h.attr("id",l+"-"+(n?1:2)+"-"+c),h.attr("node-id",c))}s.call(this,!0),s.call(this,!1),e(t).treegrid("fixRowHeight",r)},deleteRow:function(t,r){var n=e.data(t,"treegrid").options,i=n.finder.getTr(t,r);i.next("tr.treegrid-tr-tree").remove(),i.remove();var a=function(r){var i,a=e(t).treegrid("getParent",r);i=a?a.children:e(t).treegrid("getData");for(var d=0;d<i.length;d++)if(i[d][n.idField]==r){i.splice(d,1);break}return a}(r);if(a&&0==a.children.length){(i=n.finder.getTr(t,a[n.idField])).next("tr.treegrid-tr-tree").remove();var d=i.children('td[field="'+n.treeField+'"]').children("div.datagrid-cell");d.find(".tree-icon").removeClass("tree-folder").addClass("tree-file"),d.find(".tree-hit").remove(),e('<span class="tree-indent"></span>').prependTo(d)}this.setEmptyMsg(t)},onBeforeRender:function(t,r,n){if(e.isArray(r)&&(n={total:r.length,rows:r},r=null),!n)return!1;var i=e.data(t,"treegrid"),a=i.options;if(null==n.length)n.footer&&(i.footer=n.footer),n.total&&(i.total=n.total),n=this.transfer(t,r,n.rows);else{!function e(t,r){for(var n=0;n<t.length;n++){var i=t[n];i._parentId=r,i.children&&i.children.length&&e(i.children,i[a.idField])}}(n,r)}this.sort(t,n),this.treeNodes=n,this.treeLevel=e(t).treegrid("getLevel",r);var d=p(t,r);d?d.children?d.children=d.children.concat(n):d.children=n:i.data=i.data.concat(n)},sort:function(t,r){var n=e.data(t,"treegrid").options;if(!n.remoteSort&&n.sortName){var i=n.sortName.split(","),a=n.sortOrder.split(",");!function r(n){n.sort((function(r,n){for(var d=0,o=0;o<i.length;o++){var l=i[o],c=a[o];if(0!=(d=(e(t).treegrid("getColumnOption",l).sorter||function(e,t){return e==t?0:e>t?1:-1})(r[l],n[l])*("asc"==c?1:-1)))return d}return d}));for(var d=0;d<n.length;d++){var o=n[d].children;o&&o.length&&r(o)}}(r)}},transfer:function(t,r,n){for(var i=e.data(t,"treegrid").options,a=e.extend([],n),d=s(r,a),o=e.extend([],d);o.length;){var l=o.shift(),c=s(l[i.idField],a);c.length&&(l.children?l.children=l.children.concat(c):l.children=c,o=o.concat(c))}return d;function s(e,t){for(var r=[],n=0;n<t.length;n++){var i=t[n];i._parentId==e&&(r.push(i),t.splice(n,1),n--)}return r}}});e.fn.treegrid.defaults=e.extend({},e.fn.datagrid.defaults,{treeField:null,checkbox:!1,cascadeCheck:!0,onlyLeafCheck:!1,lines:!1,animate:!1,singleSelect:!0,view:C,rowEvents:e.extend({},e.fn.datagrid.defaults.rowEvents,{mouseover:n(!0),mouseout:n(!1),click:function(t){var r=e(t.target),n=r.closest("tr.datagrid-row");if(n.length&&n.parent().length){var a=n.attr("node-id"),d=e(n).closest("div.datagrid-view").children(".datagrid-f")[0];if(r.hasClass("tree-hit"))k(d,a);else if(r.hasClass("tree-checkbox"))i(d,a);else{var o=e(d).datagrid("options");if(r.parent().hasClass("datagrid-cell-check")||o.singleSelect||!t.shiftKey)e.fn.datagrid.defaults.rowEvents.click(t);else{var l=e(d).treegrid("getChildren"),c=e.easyui.indexOfArray(l,o.idField,o.lastSelectedIndex),s=e.easyui.indexOfArray(l,o.idField,a),h=Math.min(Math.max(c,0),s),f=Math.max(c,s),u=l[s],g=r.closest("td[field]",n);if(g.length){var p=g.attr("field");o.onClickCell.call(d,a,p,u[p])}e(d).treegrid("clearSelections");for(var v=h;v<=f;v++)e(d).treegrid("selectRow",l[v][o.idField]);o.onClickRow.call(d,u)}}}}}),loader:function(t,r,n){var i=e(this).treegrid("options");if(!i.url)return!1;e.ajax({type:i.method,url:i.url,data:t,dataType:"json",success:function(e){r(e)},error:function(){n.apply(this,arguments)}})},loadFilter:function(e,t){return e},finder:{getTr:function(t,r,n,i){n=n||"body",i=i||0;var a=e.data(t,"datagrid").dc;if(0==i){var d=e.data(t,"treegrid").options,o=d.finder.getTr(t,r,n,1),l=d.finder.getTr(t,r,n,2);return o.add(l)}if("body"==n){var c=e("#"+e.data(t,"datagrid").rowIdPrefix+"-"+i+"-"+r);return c.length||(c=(1==i?a.body1:a.body2).find('tr[node-id="'+r+'"]')),c}return"footer"==n?(1==i?a.footer1:a.footer2).find('tr[node-id="'+r+'"]'):"selected"==n?(1==i?a.body1:a.body2).find("tr.datagrid-row-selected"):"highlight"==n?(1==i?a.body1:a.body2).find("tr.datagrid-row-over"):"checked"==n?(1==i?a.body1:a.body2).find("tr.datagrid-row-checked"):"last"==n?(1==i?a.body1:a.body2).find("tr:last[node-id]"):"allbody"==n?(1==i?a.body1:a.body2).find("tr[node-id]"):"allfooter"==n?(1==i?a.footer1:a.footer2).find("tr[node-id]"):void 0},getRow:function(t,r){var n="object"==typeof r?r.attr("node-id"):r;return e(t).treegrid("find",n)},getRows:function(t){return e(t).treegrid("getChildren")}},onBeforeLoad:function(e,t){},onLoadSuccess:function(e,t){},onLoadError:function(){},onBeforeCollapse:function(e){},onCollapse:function(e){},onBeforeExpand:function(e){},onExpand:function(e){},onClickRow:function(e){},onDblClickRow:function(e){},onClickCell:function(e,t){},onDblClickCell:function(e,t){},onContextMenu:function(e,t){},onBeforeEdit:function(e){},onAfterEdit:function(e,t){},onCancelEdit:function(e){},onBeforeCheckNode:function(e,t){},onCheckNode:function(e,t){}})}(jQuery);