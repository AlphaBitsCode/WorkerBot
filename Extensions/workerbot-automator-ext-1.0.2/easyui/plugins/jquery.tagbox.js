/* Copyright (C) 2023 by WorkerBot.AI */
!function(t){function e(e,o){var a=t(e).next(),n=o?t(o):a.find(".tagbox-label");if(n.length){var i=t(e).tagbox("textbox"),s=t(n[0]),r=s.outerHeight(!0)-s.outerHeight(),x=i.outerHeight()-2*r;n.css({height:x+"px",lineHeight:x+"px"}),a.find(".textbox-addon").css("height","100%").find(".textbox-icon").css("height","100%"),a.find(".textbox-button").linkbutton("resize",{height:"100%"})}}function o(e){var o=t(e).tagbox("options"),a=t(e).tagbox("textbox"),n=t(e).next(),i=t("<span></span>").appendTo("body");i.attr("style",a.attr("style")),i.css({position:"absolute",top:-9999,left:-9999,width:"auto",fontFamily:a.css("fontFamily"),fontSize:a.css("fontSize"),fontWeight:a.css("fontWeight"),whiteSpace:"nowrap"});var s=l(a.val()),r=l(o.prompt||"");i.remove();var x=Math.min(Math.max(s,r)+20,n.width());function l(t){var e=t.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");return i.html(e),i.outerWidth()}a._outerWidth(x),n.find(".textbox-button").linkbutton("resize",{height:"100%"})}function a(e){var o=t(e),a=o.tagbox("options");if(a.limitToList){var n=o.tagbox("panel").children("div.combobox-item-hover");if(n.length){n.removeClass("combobox-item-hover");var i=a.finder.getRow(e,n)[a.valueField];t(e).tagbox(n.hasClass("combobox-item-selected")?"unselect":"select",i)}t(e).tagbox("hidePanel")}else{var s=t.trim(t(e).tagbox("getText"));if(""!==s){var r=t(e).tagbox("getValues");r.push(s),t(e).tagbox("setValues",r)}}}t.fn.tagbox=function(a,n){if("string"==typeof a){var i=t.fn.tagbox.methods[a];return i?i(this,n):this.combobox(a,n)}return a=a||{},this.each((function(){var n,i=t.data(this,"tagbox");i?t.extend(i.options,a):t.data(this,"tagbox",{options:t.extend({},t.fn.tagbox.defaults,t.fn.tagbox.parseOptions(this),a)}),function(a){var n=t.data(a,"tagbox").options;function i(){t(a).next().find(".tagbox-label").remove();var o=t(a).tagbox("textbox");t.map(t(a).tagbox("getValues"),(function(e,i){var s=n.finder.getRow(a,e),r=n.tagFormatter.call(a,e,s),x={},l=n.tagStyler.call(a,e,s)||"";x="string"==typeof l?{s:l}:{c:l.class||"",s:l.style||""};var b=t('<span class="tagbox-label"></span>').insertBefore(o).html(r);b.attr("tagbox-index",i),b.attr("style",x.s).addClass(x.c),t('<a href="javascript:;" class="tagbox-remove"></a>').appendTo(b)})),e(a),t(a).combobox("setText","")}t(a).addClass("tagbox-f").combobox(t.extend({},n,{cls:"tagbox",reversed:!0,onChange:function(e,o){i(),t(this).combobox("hidePanel"),n.onChange.call(a,e,o)},onResizing:function(i,s){var r=t(this).combobox("textbox"),x=t(this).data("textbox").textbox,l=x.outerWidth();x.css({height:"",paddingLeft:r.css("marginLeft"),paddingRight:r.css("marginRight")}),r.css("margin",0),x._outerWidth(l),o(a),e(this),n.onResizing.call(a,i,s)},onLoadSuccess:function(t){i(),n.onLoadSuccess.call(a,t)}})),i(),o(a)}(this),t(n=this).next()._unbind(".tagbox")._bind("click.tagbox",(function(e){var o=t(n).tagbox("options");if(!o.disabled&&!o.readonly){if(t(e.target).hasClass("tagbox-remove")){var a=parseInt(t(e.target).parent().attr("tagbox-index")),i=t(n).tagbox("getValues");if(0==o.onBeforeRemoveTag.call(n,i[a]))return;o.onRemoveTag.call(n,i[a]),i.splice(a,1),t(n).tagbox("setValues",i)}else{var s=t(e.target).closest(".tagbox-label");s.length&&(a=parseInt(s.attr("tagbox-index")),i=t(n).tagbox("getValues"),o.onClickTag.call(n,i[a]))}t(this).find(".textbox-text").focus()}}))._bind("keyup.tagbox",(function(t){o(n)}))._bind("mouseover.tagbox",(function(e){t(e.target).closest(".textbox-button,.textbox-addon,.tagbox-label").length?t(this).triggerHandler("mouseleave"):t(this).find(".textbox-text").triggerHandler("mouseenter")}))._bind("mouseleave.tagbox",(function(e){t(this).find(".textbox-text").triggerHandler("mouseleave")}))}))},t.fn.tagbox.methods={options:function(e){var o=e.combobox("options");return t.extend(t.data(e[0],"tagbox").options,{width:o.width,height:o.height,originalValue:o.originalValue,disabled:o.disabled,readonly:o.readonly})},setValues:function(e,a){return e.each((function(){var e,n;n=a,t(e=this).combobox("setText",""),o(e),t(e).combobox("setValues",n),t(e).combobox("setText",""),t(e).tagbox("validate")}))},reset:function(e){return e.each((function(){t(this).combobox("reset").combobox("setText","")}))}},t.fn.tagbox.parseOptions=function(e){return t.extend({},t.fn.combobox.parseOptions(e),t.parser.parseOptions(e,[]))},t.fn.tagbox.defaults=t.extend({},t.fn.combobox.defaults,{hasDownArrow:!1,multiple:!0,reversed:!0,selectOnNavigation:!1,tipOptions:t.extend({},t.fn.textbox.defaults.tipOptions,{showDelay:200}),val:function(e){var o=t(e).parent().prev().tagbox("getValues");return t(e).is(":focus")&&o.push(t(e).val()),o.join(",")},inputEvents:t.extend({},t.fn.combo.defaults.inputEvents,{blur:function(e){var o=e.data.target;t(o).tagbox("options").limitToList&&a(o)}}),keyHandler:t.extend({},t.fn.combobox.defaults.keyHandler,{enter:function(t){a(this)},query:function(e,o){t(this).tagbox("options").limitToList?t.fn.combobox.defaults.keyHandler.query.call(this,e,o):t(this).combobox("hidePanel")}}),tagFormatter:function(e,o){var a=t(this).tagbox("options");return o?o[a.textField]:e},tagStyler:function(t,e){return""},onClickTag:function(t){},onBeforeRemoveTag:function(t){},onRemoveTag:function(t){}})}(jQuery);